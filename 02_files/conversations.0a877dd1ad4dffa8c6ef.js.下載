(self.miniJsonp=self.miniJsonp||[]).push([[4997],{78232:function(e,t,r){var s;s=(e,t,r,s,o,a,n,i,c,d,l)=>(()=>{"use strict";var u={701:(e,t,r)=>{r.d(t,{t:()=>a});var s=r(661),o=r.n(s),a=o().t.bind(o())},661:e=>{e.exports=d},383:t=>{t.exports=e},252:e=>{e.exports=o},944:e=>{e.exports=i},975:e=>{e.exports=t},783:e=>{e.exports=l},511:e=>{e.exports=r},644:e=>{e.exports=s},855:e=>{e.exports=c},778:e=>{e.exports=n},611:e=>{e.exports=a}},E={};function p(e){var t=E[e];if(void 0!==t)return t.exports;var r=E[e]={exports:{}};return u[e](r,r.exports,p),r.exports}p.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return p.d(t,{a:t}),t},p.d=(e,t)=>{for(var r in t)p.o(t,r)&&!p.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},p.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),p.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var _={};return(()=>{p.r(_),p.d(_,{allConversationIdsSelector:()=>n,changeConversationStatusRequested:()=>Me,changeConversationStatusRequestedSaga:()=>or,conversationBeenDeletedSelector:()=>W,conversationDirectionSelector:()=>v,conversationHttpStatusSelector:()=>S,conversationIdsSelector:()=>o,conversationLastMessageSelector:()=>os,conversationOperateRequested:()=>we,conversationReducer:()=>xr,conversationsSelector:()=>O,converstionSyncUpdatesSaga:()=>Or,curConvsMessageSelector:()=>ps,curMessagesRelatedSelector:()=>rs,currentBuyerIdSelector:()=>h,currentBuyerSelector:()=>L,currentBuyerShopIdSelector:()=>k,currentBuyerShopSelector:()=>x,currentConversationBuyerIdSelectors:()=>P,currentConversationCanReadSelector:()=>E,currentConversationIdSelector:()=>u,currentConversationMaxOptionHideTimeSelectors:()=>M,currentConversationSelector:()=>N,currentConversationShopIdSelectors:()=>b,currentConversationShopRegionSelectors:()=>D,currentConversationShopSelectors:()=>A,currentConversationStatusSelectors:()=>U,currentConversationToNameSelector:()=>z,currentConversationTranslationAccessSelector:()=>Q,currentPendingOffersCountSelector:()=>X,currentSellerAccountIdSelector:()=>te,currentShopIdSelector:()=>V,degradeConversationIdsSelector:()=>f,deleteConversationSucceeded:()=>pe,fakeConversationSucceeded:()=>Se,feedbackSelector:()=>Us,fetchConversationsRequested:()=>ve,fetchConversationsRequestedSaga:()=>Vt,fetchConversationsTotalCount:()=>xt,fetchDegradeConversationsDetail:()=>je,fetchDueDataLoop:()=>rt,fetchMessagePreview:()=>Mt,fetchPinnedConversations:()=>Rt,filterSelector:()=>g,filteredConversationsSelector:()=>m,getConversation:()=>j,getConversationDetailRequested:()=>_e,getConversationPendingOffersCountSelector:()=>Z,getConversationShopId:()=>w,getConversationShopRegion:()=>ee,getConversations:()=>F,getConversationsDueTag:()=>wt,getConvsMessagesRelatedSelector:()=>ss,getMessageSelector:()=>ts,getPendingOffersCountRequested:()=>We,initConversationRequested:()=>tt,initConversationRequestedSaga:()=>jr,inlocationSelector:()=>d,isNavigateToUnreadMessageSelector:()=>J,keywordSelector:()=>H,listsHashSelector:()=>q,locationMessage:()=>Ge,markAsReadHandler:()=>Zt,markMessagesRequested:()=>ge,markMessagesRequestedSaga:()=>rr,markMessagesSucceeded:()=>me,mediaListSelector:()=>Os,messagesRelatedMapSelector:()=>$r,missedReadNoticeCountSelector:()=>c,muteConversationRequested:()=>qe,navigateToUnreadMessageIdSelector:()=>K,noticesCountSelector:()=>js,pinnedConversationIdsSelector:()=>a,readRequestIdsSelector:()=>i,reconnectFlagSelector:()=>Ms,redirectConversationRequested:()=>hs,replyToMessageSelector:()=>vs,resetConversationRequested:()=>Pe,resetNavigateToUnreadMessageId:()=>He,resultsSelector:()=>G,reverseMessagesSelector:()=>ds,searchConversationHttpStatusSelector:()=>B,searchConversationsRequested:()=>fr,searchConversationsSucceeded:()=>gr,selectVideoInfoByKey:()=>Zr,selectVideoInfoKeyByVid:()=>es,setConversationBeenDeleted:()=>Qe,setCurrentConversationCanRead:()=>De,setCurrentConversationId:()=>Je,setNavigateToUnreadMessage:()=>ke,setNavigateToUnreadMessageId:()=>xe,shopAccessSelector:()=>Y,showConversationRequested:()=>be,showConversationSucceeded:()=>Ue,singleConversationMarkInfoSelector:()=>oe,sortedConversationsSelector:()=>R,syncConversationFilter:()=>wr,totalConversationsCountSelector:()=>re,updateConversationFilter:()=>Ce,updateConversationFilterRequested:()=>Ke,updateConversationFilterRequestedSaga:()=>Kt,updateFetchConversationsDirection:()=>ye,updateLocationMode:()=>Be,updateReadRequestData:()=>Re,updateSearchParams:()=>mr,updateTimeNowSelector:()=>l,watchConversationSagas:()=>Lr,watchSearch:()=>Nr,watchUncontrolledSagas:()=>Ps});var e=p(383),t=p(975),r=p(511),s=p(644),o=e=>e.conversationReducer.conversationIds,a=e=>e.conversationReducer.pinnedConversationIds,n=(0,t.createSelector)(o,a,((e,t)=>{var r=e.filter((e=>!t.includes(e)));return t.concat(r)})),i=e=>e.conversationReducer.readRequestIds,c=e=>e.conversationReducer.missedReadNoticeCount,d=e=>e.conversationReducer.inlocation,l=e=>e.conversationReducer.updateTimeNow,u=e=>e.conversationReducer.currentConversationId,E=e=>e.conversationReducer.currentConversationCanRead,S=e=>e.conversationReducer.status,v=e=>e.conversationReducer.direction,O=(0,t.createSelector)(r.conversationEntitiesSelector,n,((t,r)=>((0,e.denormalize)(r,[s.conversationSchema],{conversations:t})||[]).filter(Boolean))),T=(0,t.createSelector)(O,u,((e,t)=>e.filter((e=>{var{id:r,unread_count:s}=e;return e&&(s>0||r===t)})))),y=(0,t.createSelector)(O,(e=>e.filter((e=>e.isPinned)))),C=(0,t.createSelector)(O,(e=>e.filter((e=>e.status&&"closed"===e.status)))),I=(0,t.createSelector)(O,u,((e,t)=>e.filter((e=>{var{unreplied:r,id:s}=e;return void 0===r||r||!r&&s===t})))),f=(0,t.createSelector)(O,(e=>e.filter((e=>e.lack)).map((e=>e.id))||[])),g=e=>e.conversationReducer.filter,m=(0,t.createSelector)(g,O,T,y,C,I,((e,t,r,s,o,a)=>({All:t,Unread:r,Pinned:s,Closed:o,Unreplied:a}[e]))),R=(0,t.createSelector)(m,a,r.waitingTimeFilterSelector,g,((e,t,r,s)=>{var o=e.filter((e=>!t.includes(e.id))),a=e.filter((e=>t.includes(e.id)));return o.sort(((e,t)=>parseInt(t.latest_message_id)-parseInt(e.latest_message_id))),a.concat(o).filter((e=>void 0===e.faking))})),N=(0,t.createSelector)(O,u,r.isSubAccountSelector,d,r.userEntitiesSelector,r.conversationEntitiesSelector,((t,r,o,a,n,i)=>{var c=t.find((e=>e.id===r))||{};if(a&&!c.id&&(c=(0,e.denormalize)(r,s.conversationSchema,{conversations:i})||{}),!o&&c.lack){var d=c.to_id,l=(0,e.denormalize)(d,s.userSchema,{users:n})||{},u={to_shop_id:l.shop_id,to_status:l.status,to_name:l.name||"-",to_avatar:l.avatar};return Object.assign(c,u)}return c})),h=(0,t.createSelector)(N,(e=>{var{to_id:t}=e||{};return t||null})),A=(0,t.createSelector)(N,r.shopsEntitiesSelector,((t,r)=>(0,e.denormalize)(t.shop_id,s.shopSchema,{shops:r})||{})),D=(0,t.createSelector)(A,(e=>(null==e?void 0:e.country)||"SG")),b=(0,t.createSelector)(N,(e=>e.shop_id)),P=(0,t.createSelector)(N,(e=>e.to_id)),U=(0,t.createSelector)(N,(e=>e.status)),M=(0,t.createSelector)(N,(e=>e.max_general_option_hide_time)),j=o=>(0,t.createSelector)(r.conversationEntitiesSelector,(t=>(0,e.denormalize)(o,s.conversationSchema,{conversations:t})||{})),w=e=>(0,t.createSelector)(j(e),(e=>e.shop_id)),F=e=>(0,t.createSelector)(O,(t=>e.map((e=>t.find((t=>t.id===e)))).filter(Boolean))),V=(0,t.createSelector)(N,(e=>{var{shop_id:t}=e||{};return t||null})),L=(0,t.createSelector)(r.userEntitiesSelector,N,((t,r)=>r?(0,e.denormalize)(r.to_id,s.userSchema,{users:t}):{})),k=(0,t.createSelector)(N,(e=>{var{to_shop_id:t}=e||{};return t||null})),x=(0,t.createSelector)(k,r.shopsEntitiesSelector,((t,r)=>(0,e.denormalize)(t,s.shopSchema,{shops:r})||{})),H=e=>{var t;return(null==e||null===(t=e.conversationReducer)||void 0===t?void 0:t.keyword)||""},G=e=>{var t;return(null==e||null===(t=e.conversationReducer)||void 0===t?void 0:t.results)||[]},B=e=>{var t;return(null==e||null===(t=e.conversationReducer)||void 0===t?void 0:t.searchStatus)||""},Q=(0,t.createSelector)(N,(e=>e.translationAccess)),q=e=>{var t;return null==e||null===(t=e.conversationReducer)||void 0===t?void 0:t.listsHash},W=e=>{var t;return null==e||null===(t=e.conversationReducer)||void 0===t?void 0:t.conversationBeenDeleted},z=(0,t.createSelector)(N,(e=>{var{to_name:t}=e||{};return t})),Y=e=>e.conversationReducer.access,J=e=>e.conversationReducer.isNavigateToUnreadMessage,K=e=>e.conversationReducer.navigateToUnreadMessageId,$=e=>e.conversationReducer.pendingOffersCount,X=(0,t.createSelector)(N,$,((e,t)=>{var{shop_id:r,to_id:s}=e;return t["".concat(r,"_").concat(s)]||0})),Z=e=>(0,t.createSelector)(j(e),$,((e,t)=>{var{shop_id:r,to_id:s}=e;return t["".concat(r,"_").concat(s)]||0})),ee=o=>(0,t.createSelector)(w(o),r.shopsEntitiesSelector,((t,r)=>{var o=(0,e.denormalize)(t,s.shopSchema,{shops:r})||{};return(null==o?void 0:o.country)||"SG"})),te=(0,t.createSelector)(r.isSubAccountSelector,r.currentUserIdSelector,A,((e,t,r)=>e?r.user_id:t)),re=e=>e.conversationReducer.totalConversationsCount,se=e=>e.conversationReducer.conversationMark,oe=e=>(0,t.createSelector)(se,(t=>t[e]));function ae(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ne,ie=p(252),ce=(p(611),p(778)),de=p.n(ce),le=p(944);!function(e){e.DELETE_CONVERSATION_REQUESTED="DELETE_CONVERSATION_REQUESTED",e.DELETE_CONVERSATION_SUCCEEDED="DELETE_CONVERSATION_SUCCEEDED",e.GET_CONVERSATION_DETAIL_REQUESTED="GET_CONVERSATION_DETAIL_REQUESTED",e.FAKE_CONVERSATION_SUCCEEDED="FAKE_CONVERSATION_SUCCEEDED",e.FETCH_CONVERSATIONS_REQUESTED="FETCH_CONVERSATIONS_REQUESTED",e.FETCH_CONVERSATIONS_SUCCEEDED="FETCH_CONVERSATIONS_SUCCEEDED",e.UPDATE_FETCH_CONVERSATIONS_STATUS="UPDATE_FETCH_CONVERSATIONS_STATUS",e.UPDATE_FETCH_CONVERSATIONS_DIRECTION="UPDATE_FETCH_CONVERSATIONS_DIRECTION",e.UPDATE_CONVERSATION_TIMESTAMP="UPDATE_CONVERSATION_TIMESTAMP",e.UPDATE_CONVERSATION_FILTER="UPDATE_CONVERSATION_FILTER",e.FORWARD_CONVERSATION_REQUESTED="FORWARD_CONVERSATION_REQUESTED",e.MASS_FORWARD_CONVERSATION_REQUESTED="MASS_FORWARD_CONVERSATION_REQUESTED",e.MARK_MESSAGES_REQUESTED="MARK_MESSAGES_REQUESTED",e.MARK_MESSAGES_SUCCEEDED="MARK_MESSAGES_SUCCEEDED",e.UPDATE_READ_REQUEST_DATA="UPDATE_READ_REQUEST_DATA",e.PIN_CONVERSATION_REQUESTED="PIN_CONVERSATION_REQUESTED",e.SEARCH_CONVERSATIONS_REQUESTED="SEARCH_CONVERSATIONS_REQUESTED",e.SEARCH_CONVERSATIONS_SUCCEEDED="SEARCH_CONVERSATIONS_SUCCEEDED",e.SELECTED_CONVERSATIONS_REQUESTED="SELECTED_CONVERSATIONS_REQUESTED",e.CONVERSATION_BATCH_OPERATE_REQUESTED="CONVERSATION_BATCH_OPERATE_REQUESTED",e.SET_CURRENT_CONVERSATION_CAN_READ="SET_CURRENT_CONVERSATION_CAN_READ",e.UPDATE_PREVIOUS_CONVERSATION_ID="UPDATE_PREVIOUS_CONVERSATION_ID",e.CLOSE_CONVERSATION_REQUESTED="CLOSE_CONVERSATION_REQUESTED",e.FETCH_GROUPS_REQUESTED="FETCH_GROUPS_REQUESTED",e.FETCH_MASS_GROUPS_REQUESTED="FETCH_MASS_GROUPS_REQUESTED",e.SHOW_CONVERSATION_REQUESTED="SHOW_CONVERSATION_REQUESTED",e.RESET_CONVERSATION_REQUESTED="RESET_CONVERSATION_REQUESTED",e.SHOW_CONVERSATION_SUCCEEDED="SHOW_CONVERSATION_SUCCEEDED",e.SHOW_NORMAL_CONVERSATION_SUCCEEDED="SHOW_NORMAL_CONVERSATION_SUCCEEDED",e.CHANGE_CONVERSATION_STATUS_REQUESTED="CHANGE_CONVERSATION_STATUS_REQUESTED",e.FETCH_DEGRADE_CONVERSATIONS_DETAIL="FETCH_DEGRADE_CONVERSATIONS_DETAIL",e.CONVERSATION_OPERATE_REQUESTED="CONVERSATION_OPERATE_REQUESTED",e.UPDATE_ACCESS="UPDATE_ACCESS",e.UPDATE_SEARCH_PARAMS="UPDATE_SEARCH_PARAMS",e.LOCATION_MESSAGE="LOCATION_MESSAGE",e.UPDATE_LOCATION_MODE="UPDATE_LOCATION_MODE",e.UPDATE_SYNC_TIME_NOW="UPDATE_SYNC_TIME_NOW",e.SET_CURRENT_CONVERSATION_TYPE="SET_CURRENT_CONVERSATION_TYPE",e.SET_CONVERSATION_BEEN_DELETED="SET_CONVERSATION_BEEN_DELETED",e.MUTE_CONVERSATION_REQUESTED="MUTE_CONVERSATION_REQUESTED",e.SET_NAVIGATE_TO_UNREAD_MESSAGE="SET_NAVIGATE_TO_UNREAD_MESSAGE",e.SET_NAVIGATE_TO_UNREAD_MESSAGE_ID="SET_NAVIGATE_TO_UNREAD_MESSAGE_ID",e.RESET_NAVIGATE_TO_UNREAD_MESSAGE_ID="RESET_NAVIGATE_TO_UNREAD_MESSAGE_ID",e.GET_PENDING_OFFERS_COUNT_REQUESTED="GET_PENDING_OFFERS_COUNT_REQUESTED",e.GET_PENDING_OFFERS_COUNT_SUCCEED="GET_PENDING_OFFERS_COUNT_SUCCEED",e.GET_BATCH_PENDING_OFFERS_COUNT_SUCCEED="GET_BATCH_PENDING_OFFERS_COUNT_SUCCEED",e.SET_ACTIVE_TAB="SET_ACTIVE_TAB",e.SET_ACTIVE_TAB_SUCCEED="SET_ACTIVE_TAB_SUCCEED",e.UPDATE_IS_CONTACTS_VISIBLE="UPDATE_IS_CONTACTS_VISIBLE",e.SET_CURRENT_CONVERSATION_ID="SET_CURRENT_CONVERSATION_ID",e.UPDATE_CONVERSATION_SORT_BY_FILTER="UPDATE_CONVERSATION_SORT_BY_FILTER",e.UPDATE_CONVERSATION_FILTER_REQUESTED="UPDATE_CONVERSATION_FILTER_REQUESTED",e.UPDATE_SORT_BY_FILTER_REQUESTED="UPDATE_SORT_BY_FILTER_REQUESTED",e.UPDATE_MANUAL_CLOSE_FLAG="UPDATE_MANUAL_CLOSE_FLAG",e.UPDATE_CONVERSATION_DUE_FILTERS="UPDATE_CONVERSATION_DUE_FILTERS",e.FETCH_CONVERSATIONS_TOTAL_COUNT_SUCCEEDED="FETCH_CONVERSATIONS_TOTAL_COUNT_SUCCEEDED",e.UPDATE_SELECTION="UPDATE_SELECTION",e.UPDATE_BATCH_FORWARD="UPDATE_BATCH_FORWARD",e.RESET_BATCH_FORWARD="RESET_BATCH_FORWARD",e.INIT_CONVERSATION_REQUESTED="INIT_CONVERSATION_REQUESTED",e.UPDATE_FORWARD_SHOP_ID="UPDATE_FORWARD_SHOP_ID",e.FETCH_DUE_DATA_LOOP="FETCH_DUE_DATA_LOOP",e.SET_PINNED_CONVERSATION_IDS="SET_PINNED_CONVERSATION_IDS"}(ne||(ne={}));var ue=p(855),{deleteConversationRequested:Ee,deleteConversationSucceeded:pe,getConversationDetailRequested:_e,fakeConversationSucceeded:Se,fetchConversationsRequested:ve,fetchConversationsSucceeded:Oe,updateFetchConversationsStatus:Te,updateFetchConversationsDirection:ye,updateConversationFilter:Ce,forwardConversationRequested:Ie,massForwardConversationRequested:fe,markMessagesRequested:ge,markMessagesSucceeded:me,updateReadRequestData:Re,pinConversationRequested:Ne,selectedConversationsRequested:he,conversationBatchOperateRequested:Ae,setCurrentConversationCanRead:De,showConversationRequested:be,resetConversationRequested:Pe,showConversationSucceeded:Ue,changeConversationStatusRequested:Me,fetchDegradeConversationsDetail:je,conversationOperateRequested:we,updateAccess:Fe,updateSyncTimeNow:Ve,showNormalConversationSucceeded:Le,setNavigateToUnreadMessage:ke,setNavigateToUnreadMessageId:xe,resetNavigateToUnreadMessageId:He,locationMessage:Ge,updateLocationMode:Be,setConversationBeenDeleted:Qe,muteConversationRequested:qe,getPendingOffersCountRequested:We,getPendingOffersCountSucceed:ze,getBatchPendingOffersCountSucceed:Ye,setCurrentConversationId:Je,updateConversationFilterRequested:Ke,fetchConversationsTotalCountSucceeded:$e,updateBatchForward:Xe,resetBatchForward:Ze,setPinnedConversationIds:et,initConversationRequested:tt,fetchDueDataLoop:rt}=(0,ie.createActions)({[ne.DELETE_CONVERSATION_REQUESTED]:({conversationId:e})=>({conversationId:e}),[ne.DELETE_CONVERSATION_SUCCEEDED]:({conversationId:e})=>({conversationId:e}),[ne.GET_CONVERSATION_DETAIL_REQUESTED]:({conversationId:e})=>({conversationId:e}),[ne.FAKE_CONVERSATION_SUCCEEDED]:({conversationId:e})=>({conversationId:e}),[ne.FETCH_CONVERSATIONS_REQUESTED]:({direction:e="reset",noPending:t=!1,source:r})=>({direction:e,noPending:t,source:r}),[ne.FETCH_CONVERSATIONS_SUCCEEDED]:({conversationIds:e,conversationIdsMap:t,oldestMessageRegion:r,latestMessageRegion:s,oldestReceivedMessageId:o,latestReceivedMessageId:a,oldestTimestampNano:n,latestTimestampNano:i,direction:c="reset",status:d,hasMore:l,persist:u,shouldFetchByTimestamp:E,maxLatestTimestampNano:p,maxLatestReceivedMessageId:_,syncFetchException:S,nextMessageTimeNano:v,sortByWaitTime:O,subAccountNextTimestampNano:T,subAccountLastMessageNano:y})=>({conversationIds:e,conversationIdsMap:t,oldestMessageRegion:r,latestMessageRegion:s,oldestReceivedMessageId:o,latestReceivedMessageId:a,direction:c,status:d,hasMore:l,latestTimestampNano:i,oldestTimestampNano:n,persist:u,shouldFetchByTimestamp:E,maxLatestTimestampNano:p,maxLatestReceivedMessageId:_,syncFetchException:S,nextMessageTimeNano:v,sortByWaitTime:O,subAccountNextTimestampNano:T,subAccountLastMessageNano:y}),[ne.UPDATE_FETCH_CONVERSATIONS_STATUS]:({status:e})=>({status:e}),[ne.UPDATE_FETCH_CONVERSATIONS_DIRECTION]:({direction:e})=>({direction:e}),[ne.UPDATE_CONVERSATION_FILTER]:({filter:e})=>({filter:e}),[ne.FORWARD_CONVERSATION_REQUESTED]:({conversationId:e,type:t,forwardId:r})=>({conversationId:e,type:t,forwardId:r}),[ne.MASS_FORWARD_CONVERSATION_REQUESTED]:({type:e,forwardId:t,conversationIds:r})=>({type:e,forwardId:t,conversationIds:r}),[ne.MARK_MESSAGES_REQUESTED]:({conversationId:e,isRead:t,latestMessageId:r})=>({conversationId:e,isRead:t,latestMessageId:r}),[ne.MARK_MESSAGES_SUCCEEDED]:({conversationId:e,markType:t})=>({conversationId:e,markType:t}),[ne.UPDATE_READ_REQUEST_DATA]:({requestId:e,requestIds:t,count:r})=>({requestId:e,requestIds:t,count:r}),[ne.PIN_CONVERSATION_REQUESTED]:({conversationId:e})=>({conversationId:e}),[ne.SELECTED_CONVERSATIONS_REQUESTED]:({type:e,id:t})=>({type:e,id:t}),[ne.CONVERSATION_BATCH_OPERATE_REQUESTED]:({type:e})=>({type:e}),[ne.SET_CURRENT_CONVERSATION_CAN_READ]:({currentConversationCanRead:e})=>({currentConversationCanRead:e}),[ne.SHOW_CONVERSATION_REQUESTED]:({conversation:e,previousId:t,messageId:r,sourceInfo:s,startChatErrorCallback:o})=>({conversation:e,previousId:t,messageId:r,sourceInfo:s,startChatErrorCallback:o}),[ne.RESET_CONVERSATION_REQUESTED]:()=>({}),[ne.SHOW_NORMAL_CONVERSATION_SUCCEEDED]:({conversationId:e,previousId:t=null})=>({conversationId:e,previousId:t}),[ne.CHANGE_CONVERSATION_STATUS_REQUESTED]:({conversationId:e})=>({conversationId:e}),[ne.FETCH_DEGRADE_CONVERSATIONS_DETAIL]:({conversationIds:e})=>({conversationIds:e}),[ne.CONVERSATION_OPERATE_REQUESTED]:({type:e,extra:t})=>({type:e,extra:t}),[ne.UPDATE_ACCESS]:({access:e})=>({access:e}),[ne.UPDATE_SYNC_TIME_NOW]:({updateTimeNow:e})=>({updateTimeNow:e}),[ne.SHOW_CONVERSATION_SUCCEEDED]:({conversationId:e,previousId:t=null,type:r=ue.ConversationTypeEnum.Normal})=>({conversationId:e,previousId:t,type:r}),[ne.SET_CURRENT_CONVERSATION_TYPE]:({currentConversationType:e=ue.ConversationTypeEnum.Normal})=>({currentConversationType:e}),[ne.SET_NAVIGATE_TO_UNREAD_MESSAGE]:({isNavigateToUnreadMessage:e})=>({isNavigateToUnreadMessage:e}),[ne.SET_NAVIGATE_TO_UNREAD_MESSAGE_ID]:({navigateToUnreadMessageId:e})=>({navigateToUnreadMessageId:e}),[ne.RESET_NAVIGATE_TO_UNREAD_MESSAGE_ID]:()=>{},[ne.LOCATION_MESSAGE]:({msgId:e,shopId:t})=>({msgId:e,shopId:t}),[ne.UPDATE_LOCATION_MODE]:({inlocation:e})=>({inlocation:e}),[ne.SET_CONVERSATION_BEEN_DELETED]:({conversationBeenDeleted:e})=>({conversationBeenDeleted:e}),[ne.MUTE_CONVERSATION_REQUESTED]:({conversationId:e})=>({conversationId:e}),[ne.GET_PENDING_OFFERS_COUNT_REQUESTED]:({shopId:e,buyerId:t})=>({shopId:e,buyerId:t}),[ne.GET_PENDING_OFFERS_COUNT_SUCCEED]:({shopId:e,buyerId:t,count:r})=>({shopId:e,buyerId:t,count:r}),[ne.GET_BATCH_PENDING_OFFERS_COUNT_SUCCEED]:({records:e})=>({records:e}),[ne.SET_CURRENT_CONVERSATION_ID]:({conversationId:e,previousId:t})=>({conversationId:e,previousId:t}),[ne.UPDATE_CONVERSATION_FILTER_REQUESTED]:({filter:e})=>({filter:e}),[ne.FETCH_CONVERSATIONS_TOTAL_COUNT_SUCCEEDED]:({totalConversationsCount:e})=>({totalConversationsCount:e}),[ne.UPDATE_SELECTION]:e=>e,[ne.UPDATE_BATCH_FORWARD]:({groups:e,members:t,noMatchMember:r,multipleShop:s,conversationIds:o})=>({groups:e,members:t,noMatchMember:r,multipleShop:s,conversationIds:o}),[ne.RESET_BATCH_FORWARD]:()=>({}),[ne.INIT_CONVERSATION_REQUESTED]:({from:e,callback:t})=>({from:e,callback:t}),[ne.FETCH_DUE_DATA_LOOP]:()=>({}),[ne.SET_PINNED_CONVERSATION_IDS]:({pinnedConversationIds:e})=>({pinnedConversationIds:e})}),st=p(701).t;function*ot({payload:{conversationId:e}}){try{var{shop_id:t,isPinned:o}=yield(0,le.select)(j(e)),a={method:"PUT",parent:"conversations",parentId:e,resource:o?"unpin":"pin"};t&&(a.payload=JSON.stringify({shop_id:t})),yield(0,le.call)(s.fetch,a)}catch(e){if("exceed_pinned_limit"===e.message)var n,i=null===(n=e.data)||void 0===n?void 0:n.pin_limit,c=de().alarm({showClose:!1,title:st("common.alarm"),className:"chat-modal",content:st("message.max_pinned_chats_limited",{count:i}),confirmText:st("common.confirm"),onConfirm:()=>{c.destroy()}});else yield(0,le.put)((0,r.setToastInformation)({error:e}))}}function*at({payload:{conversationId:e}}){try{var t=yield(0,le.select)(w(e));yield(0,le.call)(s.fetch,{method:"DELETE",resource:"conversations",id:e,params:{shop_id:t}})}catch(e){yield(0,le.put)((0,r.setToastInformation)({error:e}))}}const nt={[ne.DELETE_CONVERSATION_SUCCEEDED]:r.deleteConversationSucceedHandler};var it=p(783);function ct(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function dt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ct(Object(r),!0).forEach((function(t){ae(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ct(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var lt=({previousConversationIds:e,fetchedConversationIds:t,direction:r,fakeConversationId:s,sortByWaitTime:o})=>{switch(r){case"reset":if(s){var a=Array.isArray(t)?[...t]:[];return a.unshift(s),a}return t;case"latest":return o?e.filter((e=>!t.includes(e))).concat(t):t.concat(e.filter((e=>!t.includes(e))));case"older":return e.concat(t.filter((t=>!e.includes(t))));default:return t}};function ut(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function Et(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ut(Object(r),!0).forEach((function(t){ae(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ut(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function*pt(e,t,o,a,n){var i=(0,s.normalize)("conversations",e),c=yield(0,le.select)(N),{conversations:d={},shops:l={}}=yield(0,le.select)((e=>e.entityReducer)),u=(yield(0,le.select)(r.waitingTimeFilterSelector),yield(0,le.select)(g),[]);if(c&&c.faking){var E=c.id;u=lt({previousConversationIds:t,fetchedConversationIds:i.result,direction:a,fakeConversationId:E,sortByWaitTime:!1})}else u=lt({previousConversationIds:t,fetchedConversationIds:i.result,direction:a,sortByWaitTime:!1});var p=u.length<ue.persistLimit?null:[...u].splice(0,ue.persistLimit);yield(0,le.put)((0,r.updateEntities)({entities:{persist:p}})),yield(0,le.call)(r.updateOrReplaceAction,d,e,"conversations"),yield(0,le.spawn)(_t,e);var _=n&&n.length;_&&(yield(0,le.call)(r.updateOrReplaceAction,l,n,"shops"),yield(0,le.put)((0,r.updateFetchedShopIds)({shopIds:n.map((e=>e.id))}))),yield(0,le.put)((0,r.updateConversationListsHash)());var S=((e,t,r)=>{if(e){var s={};return e.forEach((e=>{s[e]=!0})),(0,ue.simpleEqualCheck)(r.slice(0,ue.persistLimit),e)?dt(dt({},t),{},{changed:!1}):{changed:!0,conversationIds:e,conversationIdsMap:s,lastConversationId:e[e.length-1]}}return null})(p,o,t);if(S&&S.changed){var v,{lastConversationId:T}=S;v="older"===a||"reset"===a?i.entities.conversations&&i.entities.conversations[T]:(yield(0,le.select)(O)).find((e=>e.id===T)),v&&(_?(S.oldestReceivedMessageId=v.latest_message_id,S.oldestMessageRegion=v.last_message_region):S.oldestTimestampNano=v.last_msg_time_nano)}return{persistObj:S,resultConversationIds:u}}function*_t(e){var t=[];if(e.forEach((e=>{(0,ue.hasTargetMessageOption)(e.last_message_option,ue.MessageOption.MSG_OPT_RECALL)&&t.push({conversation_id:e.id,shop_id:e.shop_id})})),t.length){var o=yield(0,le.call)(s.fetch,{method:"POST",parent:"conversation",resource:"last_msg_in_conversation_batch",payload:JSON.stringify({pairs:t})}),a=Object.keys(o);if(a.length){for(var n={};a.length;){var i=a.shift();if(i){var c=yield(0,le.select)(j(i));if(!(0,ue.hasTargetMessageOption)(c.last_message_option,ue.MessageOption.MSG_OPT_RECALL))continue;var d=o[i],{id:l,type:u,content:E,to_shop_id:p,created_at:_}=d,S=(0,ue.getChatBotParams)(d,{updateMaxGeneralOptionHideTime:c.shop_id!==p}),v=(0,ue.getCrmPreviewParams)(d);n[i]=Et(Et({latest_message_id:l,latest_message_type:u,latest_message_content:E,last_message_time:_},S),v)}}(0,ue.checkEmptyObject)(n)||(yield(0,le.put)((0,r.batchUpdateRecord)({name:"conversations",records:n})))}}}function St(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function vt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?St(Object(r),!0).forEach((function(t){ae(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):St(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ot=e=>(e=e.filter((e=>e)),new Promise((t=>{(0,s.fetch)({parent:"setting",resource:"auto_translations",params:{shop_ids:JSON.stringify(e)}}).then((({auto_translations:e=[]})=>{t(e)})).catch((()=>{t([])}))})));function*Tt(e){if("enabled"!==(yield(0,le.select)(r.autoTranslation))){var t=Array.from(new Set(e.map((e=>e.to_shop_id)))),s=yield(0,le.call)(Ot,t);e=e.map((e=>{var t=s.find((t=>t.shop_id===e.to_shop_id));return vt(vt({},e),{},{translationAccess:!!t&&t.is_auto_translation})}))}return e}function*yt(e){var t=[],s=[],o=yield(0,le.select)(r.fetchedShopIdsSelector);return e.forEach((e=>{!o.includes(e.shop_id)&&s.push(e.shop_id)})),s.length&&(t=yield(0,le.call)(r.fetchShopsByIds,{shopIds:[...new Set(s)]})),t}function Ct(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function It(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ct(Object(r),!0).forEach((function(t){ae(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ct(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function*ft(){var e=(yield(0,le.select)(g)).toLowerCase(),t={};e&&["unread","unreplied"].includes(e)&&(t.type=e);var s=yield(0,le.select)(r.isSubAccountSelector);return{parent:"".concat(s?"subaccount/conversations/pinned":"conversations/pinned"),resource:"list",params:t}}function*gt(){yield(0,le.put)(et({pinnedConversationIds:[]}));var e=yield(0,le.select)(r.conversationEntitiesSelector),t=Object.keys(e),s={};t.length&&t.forEach((t=>{var r=null==e?void 0:e[t];null!=r&&r.isPinned&&(s[t]={isPinned:!1})})),Object.keys(s).length&&(yield(0,le.put)((0,r.batchUpdateRecord)({name:"conversations",records:s})))}function*mt(e){if(e=yield(0,le.call)(Tt,e),yield(0,le.select)(r.isSubAccountSelector)){var t=yield(0,le.call)(yt,e);if(null!=t&&t.length){var s=yield(0,le.select)(r.shopsEntitiesSelector);yield(0,le.call)(r.updateOrReplaceAction,s,t,"shops"),yield(0,le.put)((0,r.updateFetchedShopIds)({shopIds:t.map((e=>e.id))}))}}var o=yield(0,le.select)(r.conversationEntitiesSelector);e=e.map((e=>It(It({},e),{},{isPinned:!0}))),yield(0,le.call)(r.updateOrReplaceAction,o,e,"conversations"),yield(0,le.spawn)(_t,e);var a=e.map((e=>e.id));return yield(0,le.put)(et({pinnedConversationIds:a})),yield(0,le.spawn)(jt,e),e}function*Rt(e){try{var{direction:t="reset",triggerBySync:r=!1}=e||{},o=(yield(0,le.select)(g)).toLowerCase();if(r||"older"===t||"pinned"===o)return[];var a=yield(0,le.call)(ft),{list:n=[]}=yield(0,le.call)(s.fetch,a);return yield(0,le.call)(gt),n=yield(0,le.call)(mt,n)}catch(e){return[]}}function*Nt(e,t){var s={};return e.length&&e.forEach((e=>{s[e.id]={isPinned:!0}})),Object.keys(s).length&&(yield(0,le.put)((0,r.batchUpdateRecord)({name:"conversations",records:s}))),yield(0,le.put)(et({pinnedConversationIds:[...t]})),e}function ht(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function At(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ht(Object(r),!0).forEach((function(t){ae(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ht(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Dt=["pinned","unreplied"],bt=(e,t,r,o,a,n,i)=>{var c={},d="older"===e?r:"latest"===e?o:"",l=Dt.includes(a);return c.resource=l?"conversation/list":"conversations",c.params={next_timestamp_nano:d,direction:"latest"===e&&d?"latest":"older"},"unread"===a&&(c.params.unread_only=!0),l&&(c.params.type=a),new Promise(((e,t)=>{(0,s.fetch)(c).then((({conversations:t=[],page_result:r={},attributions:s={}})=>{e([t,r,s])})).catch((e=>{t(e)}))}))},Pt=({source:e,filter:t,shopId:r,direction:o,oldestMessageRegion:a,latestMessageRegion:n,oldestReceivedMessageId:i,latestReceivedMessageId:c,subAccountNextTimestampNano:d,subAccountLastMessageNano:l,hasSortParams:u})=>{var E="",p="",_="";"older"===o?(E=a,p=i,_=d):"latest"===o&&(E=n,p=c,_=l);var S={direction:"latest"===o?"latest":"older"};return r&&(S.shop_id=r),E&&(S.last_message_region=E),p&&(S.last_received_message_id=p),S.next_timestamp_nano=_||0,t&&["unread","pinned","unreplied"].includes(t)&&(S.type=t),new Promise(((e,t)=>{(0,s.fetch)({parent:"subaccount",resource:"conversations",params:S}).then((({conversations:t=[],attributions:r={}})=>{e([t,r])})).catch((e=>{t(e)}))}))},Ut=e=>new Promise(((t,r)=>{(0,s.fetch)({subServer:"coreapi",parent:"conversation_list_by_ids",params:{conversation_ids:JSON.stringify(e)}}).then((({conversations:e=[]})=>{t(e)})).catch((e=>{r(e)}))}));function*Mt({list:e,needFetchOfferCount:t=!1,conversationId:o,handleSave:a}){for(var n=yield(0,le.select)(r.isSubAccountSelector),i=[],c=[],d=[],l=[],u={},E=0;E<e.length;E++){var{id:p,conversation_id:_,type:S,content:v,latest_message_type:O,latest_message_content:T,to_id:y,shop_id:C}=e[E],I=O||S,f=T||v,g=_||p;if(t&&l.push({buyer_id:y,shop_id:C}),["order","offer","voucher"].includes(I)){var m=yield(0,le.select)(w(g)),R=!1;if("order"===I&&n&&m!==f.shop_id&&(R=!0),!R){var N="".concat(I,"_id"),h=f[N],A="order"===I?c:"offer"===I?i:d,D=f.shop_id;0!==D&&0!==parseInt(h)&&(A.push({shop_id:D,[N]:parseInt(h)}),u[p]={type:I,itemId:h,conversationId:g})}}}if(Object.keys(u).length||l.length){var b,P={},U=yield(0,le.select)(r.currentUserShopIdSelector);U||o&&(U=yield(0,le.select)(w(o))),U&&(P={params:{shop_id:U}});try{b=yield(0,le.call)(s.fetch,At(At({method:"POST",parent:"chat_preview",resource:"detail"},P),{},{payload:JSON.stringify({offer_preview_req:i,order_preview_req:c,voucher_preview_req:d,offer_count_req:l})}))}catch(e){b={}}var{vouchers:M=[],offers:j=[],orders:F=[],buyer_offer_counts:V=[]}=b;if(M.length||j.length||F.length||V.length){var L={},k=Object.keys(u),x=function*(e){var t=void 0,{type:r,itemId:s,conversationId:o}=u[e],a=yield(0,le.select)(ee(o));switch(r){case"voucher":var n=M.find((e=>e.id===s));t=n?At(At({},n),{},{rule_text:(0,ue.formatRuleText)(n),discount_text:(0,ue.formatDiscountText)(n)}):n;break;case"offer":var i=j.find((e=>e.id===s));t=i?At(At({},i),{},{offer_price:(0,ue.formatSinglePrice)(i.offer_price,a)}):i;break;case"order":t=F.find((e=>e.id===s))}t&&(L[e]=t)};for(var H of k)yield*x(H);a&&a({records:L,buyerOfferCounts:V})}}}function*jt(e){var t={},s={};yield(0,le.call)(Mt,{list:e,needFetchOfferCount:!0,handleSave:({records:e,buyerOfferCounts:r})=>{Object.keys(e).forEach((r=>{t[r]={latest_message_content:e[r]}})),r.forEach((e=>{var{shop_id:t,buyer_id:r,pending_count:o}=e,a="".concat(t,"_").concat(r);s[a]=o}))}}),yield(0,le.put)((0,r.batchUpdateRecord)({name:"conversations",records:t})),yield(0,le.put)(Ye({records:s}))}function wt({list:e=[]}){var t={},r=Date.now()*10**6;return e.forEach((e=>{var s="",{due_attr:o=[],id:a}=e;if(null!=o&&o.length){var{due_timestamp:n}=o.find((e=>3===e.display_tag)),{due_timestamp:i}=o.find((e=>2===e.display_tag)),{due_timestamp:c}=o.find((e=>1===e.display_tag));r>=i&&r<n?s="overdue":r>=c&&r<i&&(s="duesoon")}t[a]={dueTag:s}})),t}function*Ft({shouldFetchByTimestamp:e,direction:t,nextMessageTimeNano:r,oldestTimestampNano:s,storedLatestTimestampNano:o,conversationFilter:a,hasSortParams:n,source:i,shopId:c,oldestMessageRegion:d,latestMessageRegion:l,oldestReceivedMessageId:u,storedLatestReceivedMessageId:E,subAccountNextTimestampNano:p,subAccountLastMessageNano:_}){var S=[],v={},O={};return e?[S,v,O]=yield(0,le.call)(bt,t,r,s,o,a,n,i):[S,O]=yield(0,le.call)(Pt,{source:i,shopId:c,direction:t,oldestMessageRegion:d,latestMessageRegion:l,oldestReceivedMessageId:u,latestReceivedMessageId:E,filter:a,subAccountNextTimestampNano:p,subAccountLastMessageNano:_,hasSortParams:n}),[S,v,O]}function*Vt({payload:{direction:e,noPending:t,source:o,startChatErrorCallback:a}}){var n="latest"===e,i=(yield(0,le.select)(g)).toLowerCase(),c=(yield(0,le.select)(r.waitingTimeFilterSelector),yield(0,le.select)(r.isSubAccountSelector)),d=(yield(0,le.select)(r.showCrrDueSelector),!c),l=o===ue.ConversationSource.SYNC,u="pinned"===i;"reset"===e&&(yield(0,le.put)((0,it.resetConversationQueue)()),yield(0,le.put)(Oe({conversationIds:[],oldestMessageRegion:"",latestMessageRegion:"",oldestReceivedMessageId:"",latestReceivedMessageId:"",maxLatestReceivedMessageId:"",oldestTimestampNano:"",latestTimestampNano:"",maxLatestTimestampNano:"",direction:"reset",hasMore:!0,status:ue.DataFetchStatus.SUCCEED,persist:null,shouldFetchByTimestamp:d,subAccountNextTimestampNano:"",subAccountLastMessageNano:""})),yield(0,le.call)(gt));var{oldestTimestampNano:E,latestTimestampNano:p,maxLatestTimestampNano:_,oldestReceivedMessageId:S,latestReceivedMessageId:v,maxLatestReceivedMessageId:O,hasMore:T,persist:y,conversationIds:C,status:I,syncFetchException:f,currentConversationId:m,oldestMessageRegion:R,latestMessageRegion:N,nextMessageTimeNano:h,subAccountNextTimestampNano:A,subAccountLastMessageNano:D}=yield(0,le.select)((e=>e.conversationReducer)),b="reset"===e||(d?!E:!S)&&"older"===e;try{if("older"!==e||(d?"0"!==E:T)){t||(yield(0,le.put)(Te({status:b?ue.DataFetchStatus.INIT_PENDING:ue.DataFetchStatus.PENDING})));var P=[],U={},M={},j=[];[[P,U,M],j]=yield(0,le.all)([(0,le.call)(Ft,{shouldFetchByTimestamp:d,direction:e,nextMessageTimeNano:h,oldestTimestampNano:E,storedLatestTimestampNano:p,conversationFilter:i,hasSortParams:!1,source:o,shopId:null,oldestMessageRegion:R,latestMessageRegion:N,oldestReceivedMessageId:S,storedLatestReceivedMessageId:v,subAccountNextTimestampNano:A,subAccountLastMessageNano:D}),(0,le.call)(Rt,{direction:e,triggerBySync:l})]);var w=P.length;if(w){if("reset"!==e||d&&!Dt.includes(i)){var F,V,L=P[w-1],k="older"===e;if(d?(F=k?E:p,V=k?L.next_timestamp_nano:L.last_message_time_nano):(F=k?S:v,V=L.latest_message_id),F&&V&&!(k?V<F:V>F))return void(yield(0,le.put)(Oe({direction:e,status:ue.DataFetchStatus.SUCCEED,hasMore:n,persist:y,oldestReceivedMessageId:S,latestReceivedMessageId:v,oldestMessageRegion:R,latestMessageRegion:N,maxLatestReceivedMessageId:v,conversationIds:C,oldestTimestampNano:E,latestTimestampNano:p,maxLatestTimestampNano:p,shouldFetchByTimestamp:d,subAccountNextTimestampNano:A,subAccountLastMessageNano:D})))}P=yield(0,le.call)(Tt,P);var x,H={};if(P.forEach((e=>{H[e.id]=!0})),u){var G=[...P];(0,r.sortConversations)(G),x=G[0]}else(0,r.sortConversations)(P),x=P[0];var B=(0,r.getTimestamp)(x,U.next_cursor),Q=x.latest_message_id,q={status:ue.DataFetchStatus.SUCCEED,direction:e,conversationIdsMap:H,shouldFetchByTimestamp:d,latestMessageRegion:x.last_message_region,maxLatestReceivedMessageId:!O||O<Q?Q:O};if(d){var W,z,{oldestTimestampNano:Y,latestTimestampNano:J}=B,{conversationIds:K,persist:$}=yield(0,le.select)((e=>e.conversationReducer)),{persistObj:X,resultConversationIds:Z}=yield(0,le.call)(pt,P,K,$,e);q=Object.assign({},q,{sortByWaitTime:!1,nextMessageTimeNano:null===(W=U)||void 0===W||null===(z=W.next_cursor)||void 0===z?void 0:z.next_message_time_nano,oldestTimestampNano:Y,latestTimestampNano:J,persist:X,conversationIds:Z,maxLatestTimestampNano:!_||_<J?J:_})}else{var ee=yield(0,le.call)(yt,P),{conversationIds:te,persist:re}=yield(0,le.select)((e=>e.conversationReducer)),se=yield(0,le.call)(pt,P,te,re,e,ee),oe=P[w-1];q=Object.assign({},q,{hasMore:!0,conversationIdsMap:H,persist:se.persistObj,oldestMessageRegion:oe.last_message_region,oldestReceivedMessageId:oe.latest_message_id,latestReceivedMessageId:Q,conversationIds:se.resultConversationIds,subAccountNextTimestampNano:x.next_timestamp_nano,subAccountLastMessageNano:x.last_message_time_nano})}if(l&&m&&H[m]){var ae=P.find((e=>e.id===m)),{latest_message_id:ne}=ae||{},ie=yield(0,le.select)(ps);ne!==(ie.length?ie[ie.length-1].id:"")&&(yield(0,le.put)((0,it.fetchMessagesRequested)({conversationId:null==ae?void 0:ae.id,reset:!0})))}yield(0,le.put)(Oe(q)),yield(0,le.spawn)(jt,P),u&&(yield(0,le.call)(Nt,P,q.conversationIds)),n?d?"0"!==B.nextTimestampNano&&(yield(0,le.put)(ve({direction:e,noPending:!0}))):yield(0,le.put)(ve({direction:e,noPending:!0})):q.conversationIds.length<=20&&(yield(0,le.put)(ve({direction:"older",noPending:!0})))}else yield(0,le.put)(Oe({direction:e,status:ue.DataFetchStatus.SUCCEED,hasMore:n,persist:y,oldestReceivedMessageId:S,latestReceivedMessageId:v,oldestMessageRegion:R,latestMessageRegion:N,maxLatestReceivedMessageId:O,oldestTimestampNano:E,latestTimestampNano:p,maxLatestTimestampNano:_,shouldFetchByTimestamp:d,syncFetchException:l?f+1:0,nextMessageTimeNano:h,subAccountNextTimestampNano:A,subAccountLastMessageNano:D}))}else I!==ue.DataFetchStatus.INIT_FAILED&&(yield(0,le.put)(Te({status:ue.DataFetchStatus.SUCCEED})))}catch(e){a&&a(ue.StartChatErrorCode.Conversations),e instanceof s.TemporyError||e instanceof s.NotFound?yield(0,le.put)(Te({status:ue.DataFetchStatus.TEMPORY_ERROR})):yield(0,le.put)(Te({status:b?ue.DataFetchStatus.INIT_FAILED:ue.DataFetchStatus.FAILED}))}}function*Lt({payload:{conversationIds:e=[]}}){try{if(e.length||(e=yield(0,le.select)(f)),e.length){var t=(yield(0,le.call)(Ut,e.slice(0,20))).filter((e=>!e.lack));if(t.length){var s={};t.forEach((e=>{s[e.id]=e})),yield(0,le.put)((0,r.batchUpdateRecord)({name:"conversations",records:s}))}}}catch(e){}}function*kt({payload:{shopId:e,buyerId:t}}){try{var{pending_count:r}=yield(0,le.call)(s.fetch,{parent:"offer",resource:"count",params:{shop_id:e,buyer_id:t}});yield(0,le.put)(ze({shopId:e,buyerId:t,count:r}))}catch(r){yield(0,le.put)(ze({shopId:e,buyerId:t,count:0}))}}function*xt(){try{var{attributes:e}=yield(0,le.call)(s.fetch,{parent:"conversation",resource:"attr",params:{}}),{total_unreplied_conv_count:t,total_due_soon_conv_count:r,total_over_due_conv_count:o,total_pinned_conv_count:a,total_unread_conv_count:n}=e;yield(0,le.put)($e({totalConversationsCount:{unrepliedCount:t,duesoonCount:r,overdueCount:o,pinnedCount:a,unreadCount:n}}))}catch(e){}}const Ht={[ne.FETCH_CONVERSATIONS_SUCCEEDED]:(e,{payload:{conversationIds:t,conversationIdsMap:r={},oldestMessageRegion:s,latestMessageRegion:o,oldestReceivedMessageId:a,latestReceivedMessageId:n,direction:i="reset",status:c,hasMore:d,oldestTimestampNano:l,latestTimestampNano:u,persist:E,shouldFetchByTimestamp:p,maxLatestReceivedMessageId:_,maxLatestTimestampNano:S,syncFetchException:v=0,nextMessageTimeNano:O,sortByWaitTime:T,subAccountNextTimestampNano:y,subAccountLastMessageNano:C}})=>{var I=At(At({},e),{},{status:c,hasMore:d,persist:E,conversationIds:t||e.conversationIds,conversationIdsMap:"reset"===i?r:At(At({},e.conversationIdsMap),r),direction:"latest"===i?i:"older",maxLatestReceivedMessageId:_,maxLatestTimestampNano:S,syncFetchException:v,nextMessageTimeNano:O});switch(i){case"reset":p?(I.latestTimestampNano=u,I.oldestTimestampNano=l):(I.oldestReceivedMessageId=a,I.latestReceivedMessageId=n,I.subAccountNextTimestampNano=y,I.subAccountLastMessageNano=C);break;case"latest":p?I.latestTimestampNano=u>e.latestTimestampNano?u:e.latestTimestampNano:(I.latestReceivedMessageId=n,I.subAccountLastMessageNano=C);break;case"older":p?(I.oldestTimestampNano=l,T&&(I.latestTimestampNano=u)):(I.oldestReceivedMessageId=a,I.subAccountNextTimestampNano=y)}return s&&(I.oldestMessageRegion=s),o&&(I.latestMessageRegion=o),I},[ne.UPDATE_FETCH_CONVERSATIONS_STATUS]:(0,r.pureActionHandler)(),[ne.UPDATE_FETCH_CONVERSATIONS_DIRECTION]:(0,r.pureActionHandler)(),[ne.UPDATE_CONVERSATION_TIMESTAMP]:(0,r.pureActionHandler)(),[ne.GET_PENDING_OFFERS_COUNT_SUCCEED]:(e,{payload:{shopId:t,buyerId:r,count:s}})=>{var o="".concat(t,"_").concat(r);return At(At({},e),{},{pendingOffersCount:At(At({},e.pendingOffersCount),{},{[o]:s})})},[ne.GET_BATCH_PENDING_OFFERS_COUNT_SUCCEED]:(e,{payload:{records:t}})=>At(At({},e),{},{pendingOffersCount:At(At({},e.pendingOffersCount),t)}),[ne.FETCH_CONVERSATIONS_TOTAL_COUNT_SUCCEEDED]:(0,r.pureActionHandler)(),[ne.SET_PINNED_CONVERSATION_IDS]:(e,{payload:{pinnedConversationIds:t}})=>At(At({},e),{},{pinnedConversationIds:t||e.pinnedConversationIds})};function Gt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function Bt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Gt(Object(r),!0).forEach((function(t){ae(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function*Qt({conversation:e,isSubAccount:t}){var{id:r,to_id:o}=e,a={};if(!t){var n=yield(0,le.call)(ue.getItem,"mini-sc_redirect");if(n){var{orderId:i,productId:c,conversationId:d,shopId:l}=n;parseInt(r)===parseInt(d)&&(i?a={order_id:parseInt(i)}:c?a={product_id:parseInt(c)}:l&&(a={shop_id:parseInt(l)}))}}var{faq_session_id:u,session_expiry_timestamp:E}=yield(0,le.call)(s.fetch,{method:"POST",parent:"conversation",resource:"enter",payload:JSON.stringify(Bt({conversation_id:r,to_id:o},a))});t||(yield(0,le.put)((0,it.fetchFaqSessionSucceed)({conversationId:r,faqSessionId:u,sessionExpiryTime:E})))}function*qt({conversation:e,previousId:t,messageId:o,messageList:a,startChatErrorCallback:n,sourceInfo:i={}}){var{id:c,lack:d}=e,l=yield(0,le.select)(r.isSubAccountSelector);!l&&d&&(yield(0,le.call)(Lt,{payload:{conversationIds:[c]}}),e=yield(0,le.select)(j(c)));var{faking:u,status:E,to_id:p,shop_id:_,latest_message_id:S,to_shop_id:v,unread_count:O,last_read_message_id:T}=e;(0,s.$tracker)({shopId:_,operation:ue.TrackerOperation.IMPRESSION,section:"conversation_window",data:{convo_userid:p,conversation_id:c}}),yield(0,le.spawn)(Qt,{conversation:e,isSubAccount:l});var y=yield(0,le.select)(r.shopTranslationSettingsSelector);!(y&&y[_])&&l&&(yield(0,le.call)(r.fetchShopSettings,(0,r.fetchShopTranslationSettings)({shopId:_}))),yield(0,le.put)((0,r.showUserRequested)({userId:p,shopId:_,buyerShopId:v})),yield(0,le.put)(He());var C="number"==typeof O&&O>0&&!o;yield(0,le.put)(ke({isNavigateToUnreadMessage:C})),yield(0,le.put)((0,it.fetchMessagesRequested)({conversationId:c,messageId:o||(C?T:void 0),direction:o||C?"around":"older",messageList:a,startChatErrorCallback:n,reset:!0})),yield(0,le.put)(We({shopId:_,buyerId:p}));var I=yield(0,le.call)(it.handleCurrentConversationChange,c);if(!u&&"closed"!==E&&O>0||I){var f=I||S;yield(0,le.put)(ge({conversationId:c,isRead:!0,latestMessageId:f}))}var g={};if(l){var{auth_names:m=[]}=yield(0,le.call)(r.fetchShopAuth,{payload:{shopId:_}});yield(0,le.put)(Fe({access:m}))}if((g=yield(0,le.select)((0,r.shopSelector)(_)))||(g=yield(0,le.call)(r.showShop,{payload:{shopId:_}}),yield(0,le.put)((0,r.updateRecord)({name:"shops",id:_,record:Bt({},g)}))),l){var R=yield(0,le.select)(r.hasVerifyPhoneNumberSelector),N=(yield(0,le.select)(ps)).find((e=>e.errorCode===ue.MessageErrorCode.UNVERIFIED_PHONE_NUMBER));!R[_]&&N&&(yield(0,le.spawn)(r.checkUserVerifyStatus,_))}yield(0,le.put)((0,it.messageSyncUpdate)({conversation:e})),yield(0,le.put)(Qe({conversationBeenDeleted:!1}))}function*Wt({payload:{conversation:e,previousId:t,messageId:r,messageList:s,startChatErrorCallback:o,sourceInfo:a={}}}){try{yield(0,le.spawn)(qt,{conversation:e,previousId:t,messageId:r,messageList:s,startChatErrorCallback:o,sourceInfo:a})}catch(e){console.log("*** Show Conversation Failed: ",e)}}function*zt({payload:{conversationId:e,previousId:t}}){yield(0,le.put)(Ue({conversationId:e,previousId:t}))}function*Yt({payload:e}){var{type:t,conversationId:r,previousId:s}=e;yield(0,le.put)(Le({conversationId:r,previousId:s}))}const Jt={[ne.SHOW_NORMAL_CONVERSATION_SUCCEEDED]:(e,{payload:{conversationId:t,previousId:r}})=>Bt(Bt({},e),{},{currentConversationId:t}),[ne.RESET_CONVERSATION_REQUESTED]:e=>Bt(Bt({},e),{},{currentConversationId:null}),[ne.SET_NAVIGATE_TO_UNREAD_MESSAGE]:(0,r.pureActionHandler)(),[ne.SET_NAVIGATE_TO_UNREAD_MESSAGE_ID]:(0,r.pureActionHandler)(),[ne.RESET_NAVIGATE_TO_UNREAD_MESSAGE_ID]:e=>Bt(Bt({},e),{},{navigateToUnreadMessageId:""})};function*Kt({payload:{filter:e}}){try{var t=yield(0,le.select)(r.currentUserSelector);ue.LS.setItem("mini-filter",JSON.stringify({filter:e,userid:t.id})),yield(0,le.put)(Ce({filter:e}))}catch(e){}}const $t={[ne.UPDATE_CONVERSATION_FILTER]:(0,r.pureActionHandler)()},Xt={[ne.SET_CURRENT_CONVERSATION_CAN_READ]:(0,r.pureActionHandler)()};function*Zt(e,t,s){var o=yield(0,le.select)(oe),a="api"===s?"socket"===o:"api"===o;if(yield(0,le.put)(me({conversationId:e,markType:a?"":"api"})),!a){var{unread_count:n,shop_id:i}=yield(0,le.select)(j(e));yield(0,le.put)((0,r.updateRecord)({name:"conversations",id:e,record:{last_read_message_id:t,unread_count:0}})),yield(0,le.put)((0,it.updateUnreadCount)({type:r.unreadCountActions.MARK_AS_READ,conversation:{id:e,shop_id:i,unread_count:n}}))}}function er(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function tr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?er(Object(r),!0).forEach((function(t){ae(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):er(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function*rr({payload:{conversationId:e,isRead:t,latestMessageId:o}}){try{var a=Date.now()+"",{shop_id:n,unread_count:i,last_read_message_id:c}=yield(0,le.select)(j(e));if(t&&c===o&&!i)return;var d=t?{last_read_message_id:o}:{};n&&(d.shop_id=n),t&&(yield(0,le.put)(Re({requestId:a}))),yield(0,le.call)(s.fetch,{method:"PUT",parent:"conversations",parentId:e,resource:t?"read":"unread",params:{request_id:a},payload:JSON.stringify(tr({},d))}),t&&(yield(0,le.call)(Zt,e,o,"api"))}catch(e){yield(0,le.put)((0,r.setToastInformation)({error:e}))}}const sr={[ne.MARK_MESSAGES_SUCCEEDED]:(e,{payload:{conversationId:t,markType:r}})=>tr(tr({},e),{},{conversationMark:tr(tr({},e.conversationMark),{},{[t]:r})}),[ne.UPDATE_READ_REQUEST_DATA]:(e,{payload:{requestId:t,requestIds:r,count:s}})=>{var o=tr({},e);return t&&(o.readRequestIds=[t].concat(e.readRequestIds)),r&&(o.readRequestIds=r),s&&(o.missedReadNoticeCount=s),o}};function*or({payload:{conversationId:e}}){try{var{shop_id:t,status:o}=yield(0,le.select)(j(e));yield(0,le.call)(s.fetch,{method:"PUT",resource:"conversations",id:e,suffix:"status",payload:JSON.stringify({shop_id:t,status:"activated"===o?"closed":"activated"})})}catch(e){yield(0,le.put)((0,r.setToastInformation)({error:e}))}}function*ar({payload:{conversationId:e}}){try{var t=yield(0,le.select)(j(e)),{id:o,unread_count:a,shop_id:n}=t,i=yield(0,le.select)(u),c=yield(0,le.call)(s.fetch,{resource:"conversations",id:e,params:{shop_id:n}}),{flag:d,entry_point:l,unread_count:E,latest_message_id:p}=c;if(o)yield(0,le.put)((0,r.updateRecord)({name:"conversations",id:e,record:{flag:d,entry_point:l,unread_count:E}}));else{var{entities:_}=(0,s.normalize)("conversations",c);yield(0,le.put)((0,r.updateEntities)({entities:_}))}return a||a===c.unread_count||(yield(0,le.put)((0,it.updateUnreadCount)({conversation:c,type:r.unreadCountActions.ACTIVE_CONVERSATION}))),e===i&&E>0&&(yield(0,le.put)(ge({conversationId:e,isRead:!0,latestMessageId:p}))),c}catch(e){return{}}}function nr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function ir(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?nr(Object(r),!0).forEach((function(t){ae(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const cr={[ne.FAKE_CONVERSATION_SUCCEEDED]:(e,{payload:{conversationId:t}})=>ir(ir({},e),{},{conversationIds:[t].concat(e.conversationIds.filter((e=>t!==e)))})};function dr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}var lr={restart:Me,delete:Ee,read:ge,unread:ge,pin:Ne,unpin:Ne,mute:qe,unmute:qe};function*ur({payload:{type:e,extra:t}}){var r=lr[e];yield(0,le.put)(r(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?dr(Object(r),!0).forEach((function(t){ae(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},t)))}function Er(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function pr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Er(Object(r),!0).forEach((function(t){ae(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Er(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}lr.close=Me;var _r={hasSCAccess:"login_sellercenter",hasEditOrderAccess:"webchat_order_edit",hasViewOrderAccess:"access_my_sale",hasViewProductAccess:"access_my_product",hasEditVoucherAccess:"my_marketing_voucher_edit",hasViewVoucherAccess:"my_marketing_voucher_access",hasViewRrOrderAccess:"access_rr_detail",hasOrderDetailAccess:"access_order_detail"},Sr=e=>{var t={},r=e.length;return Object.keys(_r).forEach((s=>{t[s]=!r||e.includes(_r[s])})),t};const vr={[ne.UPDATE_ACCESS]:(e,t)=>{var r=Sr(t.payload.access);return pr(pr({},e),{},{access:r})}};function*Or(){var e=yield(0,le.select)(l);try{var t=yield(0,le.call)(s.fetch,{subServer:"coreapi",parent:"conversation",resource:"updated_conversation_list",params:{last_update_time:e}}),{conversations:o,page_result:a}=t;if(o.length>0){var n={};o.forEach((e=>{n[e.id]=e})),yield(0,le.put)((0,r.batchUpdateRecord)({name:"conversations",records:n}))}var{has_more:i,next_last_update_time:c}=a||{};c&&(yield(0,le.put)(Ve({updateTimeNow:c}))),i&&o.length>0&&(yield(0,le.call)(Or))}catch(e){e instanceof s.CustomError&&(yield(0,le.put)(Ve({updateTimeNow:"0"})),yield(0,le.call)(Vt,{payload:{direction:"reset"}}))}}const Tr={[ne.UPDATE_SYNC_TIME_NOW]:(0,r.pureActionHandler)()};function*yr({payload:{conversationId:e}}){try{var{shop_id:t,mute:o}=yield(0,le.select)(j(e)),a={biz_type:(yield(0,le.select)(r.isSubAccountSelector))?2:0};n=a,i={shop_id:t},Object.keys(i).forEach((e=>{"object"==typeof i[e]?i[e].validate()&&(n[e]=i[e].value):i[e]&&(n[e]=i[e])})),yield(0,le.call)(s.fetch,{method:"PUT",parent:"conversations",parentId:e,resource:o?"unmute":"mute",payload:JSON.stringify(a)})}catch(e){yield(0,le.put)((0,r.setToastInformation)({error:e}))}var n,i}function Cr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function Ir(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Cr(Object(r),!0).forEach((function(t){ae(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Cr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var{searchConversationsRequested:fr,searchConversationsSucceeded:gr,updateSearchParams:mr}=(0,ie.createActions)({[ne.SEARCH_CONVERSATIONS_REQUESTED]:({keyword:e="",shopId:t=""})=>({keyword:e,shopId:t}),[ne.SEARCH_CONVERSATIONS_SUCCEEDED]:({results:e,searchStatus:t})=>({results:e,searchStatus:t}),[ne.UPDATE_SEARCH_PARAMS]:({keyword:e="",searchStatus:t})=>({keyword:e,searchStatus:t})});function*Rr({payload:{keyword:e}}){var t=[],r=e.trim();if(yield(0,le.put)(mr({keyword:r,searchStatus:ue.DataFetchStatus.INIT_PENDING})),r){var s=r.toLocaleLowerCase(),{shops:o}=yield(0,le.select)((e=>e.entityReducer));(yield(0,le.select)(O)).forEach((e=>{(e.to_name||"").toLocaleLowerCase().includes(s)&&!e.faking&&t.push(Ir(Ir({},e),{},{shop_name:(o[e.shop_id]||{}).name}))}))}yield(0,le.put)(gr({results:t,searchStatus:ue.DataFetchStatus.SUCCEED}))}function*Nr(){yield(0,le.takeLatest)(fr,Rr)}const hr={[ne.SEARCH_CONVERSATIONS_SUCCEEDED]:(e,{payload:{results:t,searchStatus:r}})=>Ir(Ir({},e),{},{results:t,searchStatus:r}),[ne.UPDATE_SEARCH_PARAMS]:(e,{payload:{keyword:t,searchStatus:r}})=>Ir(Ir({},e),{},{keyword:t,searchStatus:r})};var Ar=p(701).t;function Dr(e,t){return(0,s.fetch)({parent:"conversation",resource:"conversation_info",params:{shop_id:t,message_id:e}})}function*br({payload:{msgId:e,shopId:t}}){var o={},a=(yield(0,le.select)(ps)).find((t=>t.id===e));if(yield(0,le.put)(Be({inlocation:!0})),a){var{conversation_id:n}=a;o=yield(0,le.select)(j(n)),yield(0,le.call)(Wt,{payload:{conversation:o,messageId:e,messageList:[]}}),s.EventBus.emit("scrollToMessage",e)}if(!o.id)try{var[i,c]=yield(0,le.all)([(0,le.call)(Dr,e,t),(0,le.call)(it.fetchConversationMessagesSaga,{msgId:e,shopId:t})]),{conversation_info:d=[]}=i||{},{get_messages:l=[]}=c||{};if(0===l.length||!l.find((t=>t.id===e)))throw new Error("message_not_found");if(o=d[0]){var{entities:u}=(0,s.normalize)("conversations",o);yield(0,le.put)((0,it.deleteConversationMessageHash)({conversationId:o.id})),yield(0,le.put)((0,r.updateEntities)({entities:u})),yield(0,le.delay)(300),yield(0,le.call)(Wt,{payload:{conversation:o,messageId:e,messageList:l}})}}catch(e){var E=Ar("common.server_error.warning_tips");switch(e.message){case"message_not_found":E=Ar("message.server_error.not_found");break;case"conversation_not_found":E=Ar("conversation.server_error.deleted"),yield(0,le.put)(Qe({conversationBeenDeleted:!0})),yield(0,le.put)(Pe())}yield(0,le.call)(r.setToastInformationSaga,(0,r.setToastInformation)({toast:{show:!0,type:"fail",message:E}}))}}const Pr={[ne.UPDATE_LOCATION_MODE]:(0,r.pureActionHandler)(),[ne.SET_CONVERSATION_BEEN_DELETED]:(0,r.pureActionHandler)()};var Ur=!0;function*Mr(){var e=yield(0,le.select)(N);if(e){var{status:t,id:r,unread_count:s,latest_message_id:o}=e;"closed"!==t&&s>0&&(yield(0,le.put)(ge({conversationId:r,isRead:!0,latestMessageId:o})))}}function*jr({payload:{from:e,callback:t}}){var s,o;yield(0,le.call)(it.updateChatbotFrom,e||ue.ChatbotFromType.LandingPage),null===(s=window)||void 0===s||null===(o=s.CsChat)||void 0===o||o.minimizeCsChatWindow(),yield(0,le.call)(Mr),Ur&&(yield(0,le.spawn)(r.fetchSettings),yield(0,le.call)(Vt,{payload:{direction:"reset",startChatErrorCallback:t}}),Ur=!1),yield(0,le.call)(it.handleNewConversationMessageQueue)}function*wr(e,t){var r=JSON.parse(ue.LS.getItem("mini-filter"))||{},s=yield(0,le.select)(g);r.filter&&r.userid===e&&r.filter!==s&&(yield(0,le.put)(Ce({filter:r.filter})))}function Fr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function Vr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Fr(Object(r),!0).forEach((function(t){ae(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Lr=[function*(){yield(0,le.takeEvery)(Ee,at)},function*(){yield(0,le.takeLatest)(be,Wt),yield(0,le.takeEvery)(Je,zt),yield(0,le.takeEvery)(Ue,Yt)},function*(){yield(0,le.takeEvery)(Ne,ot)},function*(){yield(0,le.takeEvery)(ge,rr)},function*(){yield(0,le.takeEvery)(Me,or)},function*(){yield(0,le.takeEvery)(ve,Vt),yield(0,le.takeEvery)(je,Lt),yield(0,le.takeEvery)(We,kt)},function*(){yield(0,le.takeEvery)(_e,ar)},function*(){yield(0,le.takeEvery)(we,ur)},function*(){yield(0,le.takeEvery)(qe,yr)},function*(){yield(0,le.takeEvery)(Ke,Kt)},Nr,function*(){yield(0,le.takeLatest)(Ge,br)},function*(){yield(0,le.takeEvery)(tt,jr)}],kr={conversationIds:[],pinnedConversationIds:[],conversationIdsMap:{},maxLatestTimestampNano:"",latestTimestampNano:"",oldestTimestampNano:"",oldestMessageRegion:"",latestMessageRegion:"",oldestReceivedMessageId:"",latestReceivedMessageId:"",maxLatestReceivedMessageId:"",currentConversationId:null,currentConversationCanRead:!0,filter:"All",draftHash:{},status:"",hasMore:!0,persist:null,results:[],direction:"",searchStatus:"",inlocation:!1,conversationBeenDeleted:!1,syncFetchException:0,conversationMark:{},readRequestIds:[],missedReadNoticeCount:0,access:Sr([]),updateTimeNow:"0",isNavigateToUnreadMessage:!1,navigateToUnreadMessageId:"",pendingOffersCount:{},nextMessageTimeNano:"",subAccountNextTimestampNano:"",subAccountLastMessageNano:"",totalConversationsCount:{unrepliedCount:0,duesoonCount:0,overdueCount:0,pinnedCount:0,unreadCount:0},selection:{mode:!1,list:[],id:null},batchForward:{}},xr=(0,ie.handleActions)(Vr(Vr(Vr(Vr(Vr(Vr(Vr(Vr(Vr(Vr(Vr({},nt),Jt),$t),Xt),Ht),cr),sr),vr),hr),Pr),Tr),kr);function Hr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function Gr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Hr(Object(r),!0).forEach((function(t){ae(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Br,{MSG_TYPE_OFFER:Qr,MSG_TYPE_ORDER:qr,MSG_TYPE_PRODUCT:Wr,MSG_TYPE_FAQ_UNSUPPORTED:zr,MSG_TYPE_FAQ_LIVEAGENT_PROMPT:Yr,MSG_TYPE_RATE_CARD:Jr}=ue.MessageTypes,Kr=[qr,Wr],$r=(0,t.createSelector)((e=>e),(e=>(e.messageReducer||{}).messagesRelatedMap||{})),Xr=e=>{var t;return(null===(t=e.messageReducer)||void 0===t?void 0:t.videoMap)||{}},Zr=e=>(0,t.createSelector)(Xr,(t=>JSON.parse(JSON.stringify(t[e]||{})))),es=e=>(0,t.createSelector)(Xr,(t=>Object.keys(t).find((r=>t[r].vid===e)))),ts=o=>(0,t.createSelector)(r.messageEntitiesSelector,(t=>(0,e.denormalize)(o,s.messageSchema,{messages:t}))),rs=(0,t.createSelector)(u,$r,((e,t)=>t[e]||{all:[]})),ss=e=>(0,t.createSelector)($r,(t=>t[e]||{all:[],sending:[],failed:[]})),os=(Br=e=>(0,t.createSelector)(ss(e),j(e),r.messageEntitiesSelector,((e,t,s)=>(0,r.getConversationLastMessage)(e,t,s))),function(){var e=Array.prototype.slice.call(arguments);return e in(Br.memoize=Br.memoize||{})?Br.memoize[e]:Br.memoize[e]=Br.apply(this,e)}),as=(0,t.createSelector)(rs,(e=>{var t=[...e.all||[]];return e.securityTipsMessageId&&t.push(e.securityTipsMessageId),t})),ns=(0,t.createSelector)(rs,(e=>e.sending||[])),is=(0,t.createSelector)(rs,(e=>e.failed||[])),cs=(0,t.createSelector)(r.messageEntitiesSelector,as,((t,r)=>((0,e.denormalize)(r,[s.messageSchema],{messages:t})||[]).filter(Boolean))),ds=(0,t.createSelector)(cs,(e=>e.reverse())),ls=(0,t.createSelector)(N,ds,((e,t)=>e?t.filter(Boolean).reduce(((e,t)=>{var{type:r,source_type:s,source_content:o,content:a}=t;if(!s||r===Qr||[-1,0].includes(o["".concat(s,"_id")]))return e;if(Kr.includes(r)&&o){var n="".concat(r,"_id");if(a[n]===o[n])return e}var{lastSourceMessage:i,sourceList:c}=e;if(!c.length)return{sourceList:c.concat(t),lastSourceMessage:t};if(s===Wr){var d=null==o?void 0:o.product_id,l=i.source_content&&i.source_content.product_id;if(!d||l===d)return e}else if(s===qr){var u=null==o?void 0:o.order_id,E=i.source_content&&i.source_content.order_id;if(!u||[-1,0,E].includes(u))return e}return{sourceList:c.concat(t),lastSourceMessage:t}}),{sourceList:[],lastSourceMessage:null}).sourceList:[])),us=(0,t.createSelector)(ls,(e=>e.map((e=>e.id)))),Es=(0,t.createSelector)(r.entitiesSelector,cs,((t,r)=>{var o=r.filter((e=>e&&e.type===Qr)).map((e=>e.content.offer_id));return(0,e.denormalize)(o,[s.offerSchema],t)})),ps=(0,t.createSelector)(ds,us,ns,is,N,r.rateCardEntitiesSelector,Es,((e,t,r,s,o,a,n)=>o?e.filter((e=>{if(!e)return!1;var{content:t,type:r}=e;return!(![zr,Yr].includes(r)&&(!t||t&&0===Object.keys(t).length))})).map((e=>{var o=r.includes(e.id)?ue.MessageSendStatus.SENDING:s.includes(e.id)?ue.MessageSendStatus.FAILED:e.send_status?ue.MessageSendStatus.SUCCEED:null,i=t.includes(e.id),c=Object.assign({},e,{send_status:o,hasMessageSource:i}),{type:d,content:l={},message_option:u}=c;switch(d){case Qr:var E=n.find((e=>e&&e.id===l.offer_id));c=Object.assign({},c,{textContent:E});break;case Jr:var p=a[l.card_id];p&&(c=Object.assign({},c,{textContent:p}))}return(0,ue.hasTargetMessageOption)(u,ue.MessageOption.MSG_OPT_CENSORED_BLACKLIST)&&(c=Gr(Gr({},c),{},{send_status:ue.MessageSendStatus.FAILED,errorCode:ue.MessageErrorCode.BLACKLIST})),c})):[])),_s=(0,t.createSelector)((e=>{var t;return null==e||null===(t=e.messageReducer)||void 0===t?void 0:t.reply}),(e=>e?e.toMessageId:{})),Ss=(0,t.createSelector)(u,_s,((e,t)=>t[e]||"")),vs=(0,t.createSelector)(Ss,r.messageEntitiesSelector,((t,r)=>(0,e.denormalize)(t,s.messageSchema,{messages:r}))),Os=(0,t.createSelector)(u,(e=>{var t;return(null===(t=e.mediaPreviewerReducer)||void 0===t?void 0:t.mediaMap)||{}}),((e,t)=>t[e]||[]));function Ts(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function ys(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ts(Object(r),!0).forEach((function(t){ae(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ts(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Cs,Is=48e4,fs=6e4,gs=!1,ms="9223372036854775807";function Rs(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function Ns(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Rs(Object(r),!0).forEach((function(t){ae(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rs(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}!function(e){e.REDIRECT_CONVERSATION_REQUESTED="REDIRECT_CONVERSATION_REQUESTED"}(Cs||(Cs={}));var{redirectConversationRequested:hs}=(0,ie.createActions)({[Cs.REDIRECT_CONVERSATION_REQUESTED]:({userId:e,shopId:t,orderId:r,productId:s,message:o="",entryPointType:a,callback:n})=>({userId:e,shopId:t,orderId:r,productId:s,message:o,entryPointType:a,callback:n})});function*As(e){var t=(0,s.normalize)("conversations",e);yield(0,le.put)((0,r.updateEntities)({entities:t.entities}))}function*Ds({userId:e,shopId:t,callback:r}){try{return yield(0,le.call)(s.fetch,{method:"POST",resource:"conversation",suffix:"redirection",payload:JSON.stringify({user_id:parseInt(e),shop_id:t})})}catch(e){return r&&r(ue.StartChatErrorCode.Redirection),null}}function*bs({payload:{userId:e,shopId:t,orderId:s,isFromSearch:o=!1,productId:a,message:i,entryPointType:c,callback:d}}){var l=yield(0,le.select)(n),E=yield(0,le.call)(Ds,{userId:e,shopId:t,callback:d});if(E){var{id:p,faking:_,mask:S,to_name:v}=E,O={orderId:s,productId:a},T=Ns(Ns({userId:e,shopId:t},O),{},{conversationId:E.id}),y=l.length,C=_||!l.includes(p);if(c&&(yield(0,le.put)((0,it.setEntryPoint)({type:c,conversationId:p}))),C?(yield(0,le.call)(As,E),y&&(yield(0,le.put)(Se({conversationId:p})))):yield(0,le.put)((0,r.updateRecord)({name:"conversations",id:p,record:{to_name:v,mask:S}})),i&&(yield(0,le.put)((0,it.saveDraft)({conversationId:p,draft:i}))),yield(0,le.call)(ue.setItem,"mini-sc_redirect",T),((yield(0,le.select)(u))!==p||C)&&(yield(0,le.put)(Je({conversationId:E.id})),yield(0,le.put)(be({conversation:E,sourceInfo:O,startChatErrorCallback:d}))),!(yield(0,le.select)(r.showChatWindowSelector))){var I="";s?I=ue.ChatbotFromType.OrderPage:a?I=ue.ChatbotFromType.ProductPage:t&&(I=ue.ChatbotFromType.ShopPage),yield(0,le.put)((0,r.updateChatWindowStatus)({showChatWindow:!0})),yield(0,le.call)(jr,{payload:{from:I,callback:d}})}y||(yield(0,le.put)(Se({conversationId:p}))),yield(0,le.put)((0,r.updateConversationDetailStatus)({showConversationDetail:!0})),o||(yield(0,le.put)((0,it.sendMessagesRequested)({conversationId:E.id,messages:[{type:"text",content:{text:""},isFaking:!0}],more:{isFakingSource:!0}})))}}var Ps=[function*(){for(;;){var e;yield(0,le.delay)(fs),e="mini-session";var t=yield(0,ue.getItem)(e);if(t&&t.token)try{var{maxLatestReceivedMessageId:o,maxLatestTimestampNano:a}=yield(0,le.select)((e=>e.conversationReducer)),n=yield(0,le.select)(r.isSubAccountSelector),i=(yield(0,le.select)(g)).toLowerCase(),c=!n&&["all","unread"].includes(i),d=["pinned","unread"].includes(i),l={};c?l.last_timestamp_nano=a||ms:l.last_message_id=o||ms,l.last_unread_count_sync=gs;var u=yield(0,le.spawn)(s.fetch,{method:"POST",resource:"user",suffix:"sync",params:ys({},l)}),{have_new_msg:E,unread_count:p,current_version:_}=yield(0,le.join)(u);if(gs=!1,E){var{syncFetchException:S}=yield(0,le.select)((e=>e.conversationReducer));S<3&&!d&&(yield(0,le.put)(ve({direction:"latest",source:ue.ConversationSource.SYNC})))}if(p>-1){var v=yield(0,le.select)(r.totalUnreadConversationsCountSelector);v!==p&&(yield(0,le.put)((0,it.updateTotalUnreadConversationsCount)({count:p})),gs=!0),n||(fs=v!==p||E?6e4:fs>=Is?Is:2*fs)}if(_&&_!==t.version){var O=Object.assign({},t,{version:_});(0,ue.setItem)(e,O)}}catch(e){}}},function*(){yield(0,le.takeEvery)(hs,bs)}],Us=e=>{var t;return(null==e||null===(t=e.socketReducer)||void 0===t?void 0:t.feedback)||void 0},Ms=e=>{var t;return(null==e||null===(t=e.socketReducer)||void 0===t?void 0:t.reconnectFlag)||!1},js=e=>{var t;return(null==e||null===(t=e.socketReducer)||void 0===t?void 0:t.noticesCount)||0}})(),_})(),e.exports=s(r(82677),r(20573),r(53402),r(96961),r(6678),r(48833),r(79308),r(34857),r(29494),r(58518),r(38104))},66633:function(e,t,r){"use strict";e.exports=r(78232)}}]);