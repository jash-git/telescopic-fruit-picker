(self.miniJsonp=self.miniJsonp||[]).push([[4997],{55698:function(e,t,n){var r,o,a,s,c,i,u,d,l,p,f;e.exports=(r=n(82677),o=n(20573),a=n(53402),s=n(96961),c=n(6678),i=n(48833),u=n(79308),d=n(34857),l=n(29494),p=n(58518),f=n(38104),function(){"use strict";var e={701:function(e,t,n){n.d(t,{t:function(){return a}});var r=n(661),o=n.n(r),a=o().t.bind(o())},661:function(e){e.exports=p},383:function(e){e.exports=r},252:function(e){e.exports=c},944:function(e){e.exports=d},975:function(e){e.exports=o},783:function(e){e.exports=f},511:function(e){e.exports=a},644:function(e){e.exports=s},855:function(e){e.exports=l},778:function(e){e.exports=u},611:function(e){e.exports=i}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var E={};return function(){n.r(E),n.d(E,{allConversationIdsSelector:function(){return c},changeConversationStatusRequested:function(){return De},changeConversationStatusRequestedSaga:function(){return $n},conversationBeenDeletedSelector:function(){return W},conversationDirectionSelector:function(){return v},conversationHttpStatusSelector:function(){return _},conversationIdsSelector:function(){return a},conversationLastMessageSelector:function(){return Io},conversationOperateRequested:function(){return ke},conversationReducer:function(){return ao},conversationsSelector:function(){return S},converstionSyncUpdatesSaga:function(){return Or},curConvsMessageSelector:function(){return ko},curMessagesRelatedSelector:function(){return Ro},currentBuyerIdSelector:function(){return b},currentBuyerSelector:function(){return F},currentBuyerShopIdSelector:function(){return V},currentBuyerShopSelector:function(){return L},currentConversationBuyerIdSelectors:function(){return D},currentConversationCanReadSelector:function(){return f},currentConversationIdSelector:function(){return p},currentConversationMaxOptionHideTimeSelectors:function(){return k},currentConversationSelector:function(){return N},currentConversationShopIdSelectors:function(){return y},currentConversationShopRegionSelectors:function(){return A},currentConversationShopSelectors:function(){return x},currentConversationStatusSelectors:function(){return w},currentConversationToNameSelector:function(){return z},currentConversationTranslationAccessSelector:function(){return Q},currentPendingOffersCountSelector:function(){return X},currentSellerAccountIdSelector:function(){return te},currentShopIdSelector:function(){return j},degradeConversationIdsSelector:function(){return R},deleteConversationSucceeded:function(){return _e},fakeConversationSucceeded:function(){return Se},feedbackSelector:function(){return sa},fetchConversationsRequested:function(){return me},fetchConversationsRequestedSaga:function(){return ln},fetchConversationsTotalCount:function(){return En},fetchDegradeConversationsDetail:function(){return we},fetchDueDataLoop:function(){return Xe},fetchMessagePreview:function(){return sn},fetchPinnedConversations:function(){return Qt},filterSelector:function(){return C},filteredConversationsSelector:function(){return I},getConversation:function(){return P},getConversationDetailRequested:function(){return ve},getConversationPendingOffersCountSelector:function(){return Z},getConversationShopId:function(){return M},getConversationShopRegion:function(){return ee},getConversations:function(){return U},getConversationsDueTag:function(){return un},getConvsMessagesRelatedSelector:function(){return Co},getMessageSelector:function(){return go},getPendingOffersCountRequested:function(){return Qe},initConversationRequested:function(){return $e},initConversationRequestedSaga:function(){return $r},inlocationSelector:function(){return d},isNavigateToUnreadMessageSelector:function(){return J},keywordSelector:function(){return H},listsHashSelector:function(){return q},locationMessage:function(){return Le},markAsReadHandler:function(){return Hn},markMessagesRequested:function(){return Ce},markMessagesRequestedSaga:function(){return Wn},markMessagesSucceeded:function(){return Ie},mediaListSelector:function(){return jo},messagesRelatedMapSelector:function(){return So},missedReadNoticeCountSelector:function(){return u},muteConversationRequested:function(){return Be},navigateToUnreadMessageIdSelector:function(){return K},noticesCountSelector:function(){return ia},pinnedConversationIdsSelector:function(){return s},readRequestIdsSelector:function(){return i},reconnectFlagSelector:function(){return ca},redirectConversationRequested:function(){return ea},replyToMessageSelector:function(){return Uo},resetConversationRequested:function(){return Ae},resetNavigateToUnreadMessageId:function(){return Ve},resultsSelector:function(){return G},reverseMessagesSelector:function(){return Ao},searchConversationHttpStatusSelector:function(){return B},searchConversationsRequested:function(){return wr},searchConversationsSucceeded:function(){return kr},selectVideoInfoByKey:function(){return Oo},selectVideoInfoKeyByVid:function(){return To},setConversationBeenDeleted:function(){return Ge},setCurrentConversationCanRead:function(){return be},setCurrentConversationId:function(){return ze},setNavigateToUnreadMessage:function(){return je},setNavigateToUnreadMessageId:function(){return Fe},shopAccessSelector:function(){return Y},showConversationRequested:function(){return xe},showConversationSucceeded:function(){return ye},singleConversationMarkInfoSelector:function(){return oe},sortedConversationsSelector:function(){return h},syncConversationFilter:function(){return eo},totalConversationsCountSelector:function(){return ne},updateConversationFilter:function(){return Re},updateConversationFilterRequested:function(){return Ye},updateConversationFilterRequestedSaga:function(){return Mn},updateFetchConversationsDirection:function(){return ge},updateLocationMode:function(){return He},updateReadRequestData:function(){return he},updateSearchParams:function(){return Pr},updateTimeNowSelector:function(){return l},watchConversationSagas:function(){return ro},watchSearch:function(){return Ur},watchUncontrolledSagas:function(){return aa}});var e=n(383),t=n(975),r=n(511),o=n(644),a=function(e){return e.conversationReducer.conversationIds},s=function(e){return e.conversationReducer.pinnedConversationIds},c=(0,t.createSelector)(a,s,(function(e,t){var n=e.filter((function(e){return!t.includes(e)}));return t.concat(n)})),i=function(e){return e.conversationReducer.readRequestIds},u=function(e){return e.conversationReducer.missedReadNoticeCount},d=function(e){return e.conversationReducer.inlocation},l=function(e){return e.conversationReducer.updateTimeNow},p=function(e){return e.conversationReducer.currentConversationId},f=function(e){return e.conversationReducer.currentConversationCanRead},_=function(e){return e.conversationReducer.status},v=function(e){return e.conversationReducer.direction},S=(0,t.createSelector)(r.conversationEntitiesSelector,c,(function(t,n){return((0,e.denormalize)(n,[o.conversationSchema],{conversations:t})||[]).filter(Boolean)})),m=(0,t.createSelector)(S,p,(function(e,t){return e.filter((function(e){var n=e.id,r=e.unread_count;return e&&(r>0||n===t)}))})),O=(0,t.createSelector)(S,(function(e){return e.filter((function(e){return e.isPinned}))})),T=(0,t.createSelector)(S,(function(e){return e.filter((function(e){return e.status&&"closed"===e.status}))})),g=(0,t.createSelector)(S,p,(function(e,t){return e.filter((function(e){var n=e.unreplied,r=e.id;return void 0===n||n||!n&&r===t}))})),R=(0,t.createSelector)(S,(function(e){return e.filter((function(e){return e.lack})).map((function(e){return e.id}))||[]})),C=function(e){return e.conversationReducer.filter},I=(0,t.createSelector)(C,S,m,O,T,g,(function(e,t,n,r,o,a){return{All:t,Unread:n,Pinned:r,Closed:o,Unreplied:a}[e]})),h=(0,t.createSelector)(I,s,r.waitingTimeFilterSelector,C,(function(e,t,n,r){var o=e.filter((function(e){return!t.includes(e.id)})),a=e.filter((function(e){return t.includes(e.id)}));return o.sort((function(e,t){return parseInt(t.latest_message_id)-parseInt(e.latest_message_id)})),a.concat(o).filter((function(e){return void 0===e.faking}))})),N=(0,t.createSelector)(S,p,r.isSubAccountSelector,d,r.userEntitiesSelector,r.conversationEntitiesSelector,(function(t,n,r,a,s,c){var i=t.find((function(e){return e.id===n}))||{};if(a&&!i.id&&(i=(0,e.denormalize)(n,o.conversationSchema,{conversations:c})||{}),!r&&i.lack){var u=i.to_id,d=(0,e.denormalize)(u,o.userSchema,{users:s})||{},l={to_shop_id:d.shop_id,to_status:d.status,to_name:d.name||"-",to_avatar:d.avatar};return Object.assign(i,l)}return i})),b=(0,t.createSelector)(N,(function(e){return(e||{}).to_id||null})),x=(0,t.createSelector)(N,r.shopsEntitiesSelector,(function(t,n){return(0,e.denormalize)(t.shop_id,o.shopSchema,{shops:n})||{}})),A=(0,t.createSelector)(x,(function(e){return(null==e?void 0:e.country)||"SG"})),y=(0,t.createSelector)(N,(function(e){return e.shop_id})),D=(0,t.createSelector)(N,(function(e){return e.to_id})),w=(0,t.createSelector)(N,(function(e){return e.status})),k=(0,t.createSelector)(N,(function(e){return e.max_general_option_hide_time})),P=function(n){return(0,t.createSelector)(r.conversationEntitiesSelector,(function(t){return(0,e.denormalize)(n,o.conversationSchema,{conversations:t})||{}}))},M=function(e){return(0,t.createSelector)(P(e),(function(e){return e.shop_id}))},U=function(e){return(0,t.createSelector)(S,(function(t){return e.map((function(e){return t.find((function(t){return t.id===e}))})).filter(Boolean)}))},j=(0,t.createSelector)(N,(function(e){return(e||{}).shop_id||null})),F=(0,t.createSelector)(r.userEntitiesSelector,N,(function(t,n){return n?(0,e.denormalize)(n.to_id,o.userSchema,{users:t}):{}})),V=(0,t.createSelector)(N,(function(e){return(e||{}).to_shop_id||null})),L=(0,t.createSelector)(V,r.shopsEntitiesSelector,(function(t,n){return(0,e.denormalize)(t,o.shopSchema,{shops:n})||{}})),H=function(e){var t;return(null==e||null===(t=e.conversationReducer)||void 0===t?void 0:t.keyword)||""},G=function(e){var t;return(null==e||null===(t=e.conversationReducer)||void 0===t?void 0:t.results)||[]},B=function(e){var t;return(null==e||null===(t=e.conversationReducer)||void 0===t?void 0:t.searchStatus)||""},Q=(0,t.createSelector)(N,(function(e){return e.translationAccess})),q=function(e){var t;return null==e||null===(t=e.conversationReducer)||void 0===t?void 0:t.listsHash},W=function(e){var t;return null==e||null===(t=e.conversationReducer)||void 0===t?void 0:t.conversationBeenDeleted},z=(0,t.createSelector)(N,(function(e){return(e||{}).to_name})),Y=function(e){return e.conversationReducer.access},J=function(e){return e.conversationReducer.isNavigateToUnreadMessage},K=function(e){return e.conversationReducer.navigateToUnreadMessageId},$=function(e){return e.conversationReducer.pendingOffersCount},X=(0,t.createSelector)(N,$,(function(e,t){var n=e.shop_id,r=e.to_id;return t["".concat(n,"_").concat(r)]||0})),Z=function(e){return(0,t.createSelector)(P(e),$,(function(e,t){var n=e.shop_id,r=e.to_id;return t["".concat(n,"_").concat(r)]||0}))},ee=function(n){return(0,t.createSelector)(M(n),r.shopsEntitiesSelector,(function(t,n){var r=(0,e.denormalize)(t,o.shopSchema,{shops:n})||{};return(null==r?void 0:r.country)||"SG"}))},te=(0,t.createSelector)(r.isSubAccountSelector,r.currentUserIdSelector,x,(function(e,t,n){return e?n.user_id:t})),ne=function(e){return e.conversationReducer.totalConversationsCount},re=function(e){return e.conversationReducer.conversationMark},oe=function(e){return(0,t.createSelector)(re,(function(t){return t[e]}))};function ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var se,ce=n(252),ie=(n(611),n(778)),ue=n.n(ie),de=n(944);!function(e){e.DELETE_CONVERSATION_REQUESTED="DELETE_CONVERSATION_REQUESTED",e.DELETE_CONVERSATION_SUCCEEDED="DELETE_CONVERSATION_SUCCEEDED",e.GET_CONVERSATION_DETAIL_REQUESTED="GET_CONVERSATION_DETAIL_REQUESTED",e.FAKE_CONVERSATION_SUCCEEDED="FAKE_CONVERSATION_SUCCEEDED",e.FETCH_CONVERSATIONS_REQUESTED="FETCH_CONVERSATIONS_REQUESTED",e.FETCH_CONVERSATIONS_SUCCEEDED="FETCH_CONVERSATIONS_SUCCEEDED",e.UPDATE_FETCH_CONVERSATIONS_STATUS="UPDATE_FETCH_CONVERSATIONS_STATUS",e.UPDATE_FETCH_CONVERSATIONS_DIRECTION="UPDATE_FETCH_CONVERSATIONS_DIRECTION",e.UPDATE_CONVERSATION_TIMESTAMP="UPDATE_CONVERSATION_TIMESTAMP",e.UPDATE_CONVERSATION_FILTER="UPDATE_CONVERSATION_FILTER",e.FORWARD_CONVERSATION_REQUESTED="FORWARD_CONVERSATION_REQUESTED",e.MASS_FORWARD_CONVERSATION_REQUESTED="MASS_FORWARD_CONVERSATION_REQUESTED",e.MARK_MESSAGES_REQUESTED="MARK_MESSAGES_REQUESTED",e.MARK_MESSAGES_SUCCEEDED="MARK_MESSAGES_SUCCEEDED",e.UPDATE_READ_REQUEST_DATA="UPDATE_READ_REQUEST_DATA",e.PIN_CONVERSATION_REQUESTED="PIN_CONVERSATION_REQUESTED",e.SEARCH_CONVERSATIONS_REQUESTED="SEARCH_CONVERSATIONS_REQUESTED",e.SEARCH_CONVERSATIONS_SUCCEEDED="SEARCH_CONVERSATIONS_SUCCEEDED",e.SELECTED_CONVERSATIONS_REQUESTED="SELECTED_CONVERSATIONS_REQUESTED",e.CONVERSATION_BATCH_OPERATE_REQUESTED="CONVERSATION_BATCH_OPERATE_REQUESTED",e.SET_CURRENT_CONVERSATION_CAN_READ="SET_CURRENT_CONVERSATION_CAN_READ",e.UPDATE_PREVIOUS_CONVERSATION_ID="UPDATE_PREVIOUS_CONVERSATION_ID",e.CLOSE_CONVERSATION_REQUESTED="CLOSE_CONVERSATION_REQUESTED",e.FETCH_GROUPS_REQUESTED="FETCH_GROUPS_REQUESTED",e.FETCH_MASS_GROUPS_REQUESTED="FETCH_MASS_GROUPS_REQUESTED",e.SHOW_CONVERSATION_REQUESTED="SHOW_CONVERSATION_REQUESTED",e.RESET_CONVERSATION_REQUESTED="RESET_CONVERSATION_REQUESTED",e.SHOW_CONVERSATION_SUCCEEDED="SHOW_CONVERSATION_SUCCEEDED",e.SHOW_NORMAL_CONVERSATION_SUCCEEDED="SHOW_NORMAL_CONVERSATION_SUCCEEDED",e.CHANGE_CONVERSATION_STATUS_REQUESTED="CHANGE_CONVERSATION_STATUS_REQUESTED",e.FETCH_DEGRADE_CONVERSATIONS_DETAIL="FETCH_DEGRADE_CONVERSATIONS_DETAIL",e.CONVERSATION_OPERATE_REQUESTED="CONVERSATION_OPERATE_REQUESTED",e.UPDATE_ACCESS="UPDATE_ACCESS",e.UPDATE_SEARCH_PARAMS="UPDATE_SEARCH_PARAMS",e.LOCATION_MESSAGE="LOCATION_MESSAGE",e.UPDATE_LOCATION_MODE="UPDATE_LOCATION_MODE",e.UPDATE_SYNC_TIME_NOW="UPDATE_SYNC_TIME_NOW",e.SET_CURRENT_CONVERSATION_TYPE="SET_CURRENT_CONVERSATION_TYPE",e.SET_CONVERSATION_BEEN_DELETED="SET_CONVERSATION_BEEN_DELETED",e.MUTE_CONVERSATION_REQUESTED="MUTE_CONVERSATION_REQUESTED",e.SET_NAVIGATE_TO_UNREAD_MESSAGE="SET_NAVIGATE_TO_UNREAD_MESSAGE",e.SET_NAVIGATE_TO_UNREAD_MESSAGE_ID="SET_NAVIGATE_TO_UNREAD_MESSAGE_ID",e.RESET_NAVIGATE_TO_UNREAD_MESSAGE_ID="RESET_NAVIGATE_TO_UNREAD_MESSAGE_ID",e.GET_PENDING_OFFERS_COUNT_REQUESTED="GET_PENDING_OFFERS_COUNT_REQUESTED",e.GET_PENDING_OFFERS_COUNT_SUCCEED="GET_PENDING_OFFERS_COUNT_SUCCEED",e.GET_BATCH_PENDING_OFFERS_COUNT_SUCCEED="GET_BATCH_PENDING_OFFERS_COUNT_SUCCEED",e.SET_ACTIVE_TAB="SET_ACTIVE_TAB",e.SET_ACTIVE_TAB_SUCCEED="SET_ACTIVE_TAB_SUCCEED",e.UPDATE_IS_CONTACTS_VISIBLE="UPDATE_IS_CONTACTS_VISIBLE",e.SET_CURRENT_CONVERSATION_ID="SET_CURRENT_CONVERSATION_ID",e.UPDATE_CONVERSATION_SORT_BY_FILTER="UPDATE_CONVERSATION_SORT_BY_FILTER",e.UPDATE_CONVERSATION_FILTER_REQUESTED="UPDATE_CONVERSATION_FILTER_REQUESTED",e.UPDATE_SORT_BY_FILTER_REQUESTED="UPDATE_SORT_BY_FILTER_REQUESTED",e.UPDATE_MANUAL_CLOSE_FLAG="UPDATE_MANUAL_CLOSE_FLAG",e.UPDATE_CONVERSATION_DUE_FILTERS="UPDATE_CONVERSATION_DUE_FILTERS",e.FETCH_CONVERSATIONS_TOTAL_COUNT_SUCCEEDED="FETCH_CONVERSATIONS_TOTAL_COUNT_SUCCEEDED",e.UPDATE_SELECTION="UPDATE_SELECTION",e.UPDATE_BATCH_FORWARD="UPDATE_BATCH_FORWARD",e.RESET_BATCH_FORWARD="RESET_BATCH_FORWARD",e.INIT_CONVERSATION_REQUESTED="INIT_CONVERSATION_REQUESTED",e.UPDATE_FORWARD_SHOP_ID="UPDATE_FORWARD_SHOP_ID",e.FETCH_DUE_DATA_LOOP="FETCH_DUE_DATA_LOOP",e.SET_PINNED_CONVERSATION_IDS="SET_PINNED_CONVERSATION_IDS"}(se||(se={}));var le,pe=n(855),fe=(0,ce.createActions)((ae(le={},se.DELETE_CONVERSATION_REQUESTED,(function(e){return{conversationId:e.conversationId}})),ae(le,se.DELETE_CONVERSATION_SUCCEEDED,(function(e){return{conversationId:e.conversationId}})),ae(le,se.GET_CONVERSATION_DETAIL_REQUESTED,(function(e){return{conversationId:e.conversationId}})),ae(le,se.FAKE_CONVERSATION_SUCCEEDED,(function(e){return{conversationId:e.conversationId}})),ae(le,se.FETCH_CONVERSATIONS_REQUESTED,(function(e){var t=e.direction,n=void 0===t?"reset":t,r=e.noPending;return{direction:n,noPending:void 0!==r&&r,source:e.source}})),ae(le,se.FETCH_CONVERSATIONS_SUCCEEDED,(function(e){var t=e.conversationIds,n=e.conversationIdsMap,r=e.oldestMessageRegion,o=e.latestMessageRegion,a=e.oldestReceivedMessageId,s=e.latestReceivedMessageId,c=e.oldestTimestampNano,i=e.latestTimestampNano,u=e.direction;return{conversationIds:t,conversationIdsMap:n,oldestMessageRegion:r,latestMessageRegion:o,oldestReceivedMessageId:a,latestReceivedMessageId:s,direction:void 0===u?"reset":u,status:e.status,hasMore:e.hasMore,latestTimestampNano:i,oldestTimestampNano:c,persist:e.persist,shouldFetchByTimestamp:e.shouldFetchByTimestamp,maxLatestTimestampNano:e.maxLatestTimestampNano,maxLatestReceivedMessageId:e.maxLatestReceivedMessageId,syncFetchException:e.syncFetchException,nextMessageTimeNano:e.nextMessageTimeNano,sortByWaitTime:e.sortByWaitTime,subAccountNextTimestampNano:e.subAccountNextTimestampNano,subAccountLastMessageNano:e.subAccountLastMessageNano}})),ae(le,se.UPDATE_FETCH_CONVERSATIONS_STATUS,(function(e){return{status:e.status}})),ae(le,se.UPDATE_FETCH_CONVERSATIONS_DIRECTION,(function(e){return{direction:e.direction}})),ae(le,se.UPDATE_CONVERSATION_FILTER,(function(e){return{filter:e.filter}})),ae(le,se.FORWARD_CONVERSATION_REQUESTED,(function(e){return{conversationId:e.conversationId,type:e.type,forwardId:e.forwardId}})),ae(le,se.MASS_FORWARD_CONVERSATION_REQUESTED,(function(e){return{type:e.type,forwardId:e.forwardId,conversationIds:e.conversationIds}})),ae(le,se.MARK_MESSAGES_REQUESTED,(function(e){return{conversationId:e.conversationId,isRead:e.isRead,latestMessageId:e.latestMessageId}})),ae(le,se.MARK_MESSAGES_SUCCEEDED,(function(e){return{conversationId:e.conversationId,markType:e.markType}})),ae(le,se.UPDATE_READ_REQUEST_DATA,(function(e){return{requestId:e.requestId,requestIds:e.requestIds,count:e.count}})),ae(le,se.PIN_CONVERSATION_REQUESTED,(function(e){return{conversationId:e.conversationId}})),ae(le,se.SELECTED_CONVERSATIONS_REQUESTED,(function(e){return{type:e.type,id:e.id}})),ae(le,se.CONVERSATION_BATCH_OPERATE_REQUESTED,(function(e){return{type:e.type}})),ae(le,se.SET_CURRENT_CONVERSATION_CAN_READ,(function(e){return{currentConversationCanRead:e.currentConversationCanRead}})),ae(le,se.SHOW_CONVERSATION_REQUESTED,(function(e){return{conversation:e.conversation,previousId:e.previousId,messageId:e.messageId,sourceInfo:e.sourceInfo,startChatErrorCallback:e.startChatErrorCallback}})),ae(le,se.RESET_CONVERSATION_REQUESTED,(function(){return{}})),ae(le,se.SHOW_NORMAL_CONVERSATION_SUCCEEDED,(function(e){var t=e.conversationId,n=e.previousId;return{conversationId:t,previousId:void 0===n?null:n}})),ae(le,se.CHANGE_CONVERSATION_STATUS_REQUESTED,(function(e){return{conversationId:e.conversationId}})),ae(le,se.FETCH_DEGRADE_CONVERSATIONS_DETAIL,(function(e){return{conversationIds:e.conversationIds}})),ae(le,se.CONVERSATION_OPERATE_REQUESTED,(function(e){return{type:e.type,extra:e.extra}})),ae(le,se.UPDATE_ACCESS,(function(e){return{access:e.access}})),ae(le,se.UPDATE_SYNC_TIME_NOW,(function(e){return{updateTimeNow:e.updateTimeNow}})),ae(le,se.SHOW_CONVERSATION_SUCCEEDED,(function(e){var t=e.conversationId,n=e.previousId,r=void 0===n?null:n,o=e.type;return{conversationId:t,previousId:r,type:void 0===o?pe.ConversationTypeEnum.Normal:o}})),ae(le,se.SET_CURRENT_CONVERSATION_TYPE,(function(e){var t=e.currentConversationType;return{currentConversationType:void 0===t?pe.ConversationTypeEnum.Normal:t}})),ae(le,se.SET_NAVIGATE_TO_UNREAD_MESSAGE,(function(e){return{isNavigateToUnreadMessage:e.isNavigateToUnreadMessage}})),ae(le,se.SET_NAVIGATE_TO_UNREAD_MESSAGE_ID,(function(e){return{navigateToUnreadMessageId:e.navigateToUnreadMessageId}})),ae(le,se.RESET_NAVIGATE_TO_UNREAD_MESSAGE_ID,(function(){})),ae(le,se.LOCATION_MESSAGE,(function(e){return{msgId:e.msgId,shopId:e.shopId}})),ae(le,se.UPDATE_LOCATION_MODE,(function(e){return{inlocation:e.inlocation}})),ae(le,se.SET_CONVERSATION_BEEN_DELETED,(function(e){return{conversationBeenDeleted:e.conversationBeenDeleted}})),ae(le,se.MUTE_CONVERSATION_REQUESTED,(function(e){return{conversationId:e.conversationId}})),ae(le,se.GET_PENDING_OFFERS_COUNT_REQUESTED,(function(e){return{shopId:e.shopId,buyerId:e.buyerId}})),ae(le,se.GET_PENDING_OFFERS_COUNT_SUCCEED,(function(e){return{shopId:e.shopId,buyerId:e.buyerId,count:e.count}})),ae(le,se.GET_BATCH_PENDING_OFFERS_COUNT_SUCCEED,(function(e){return{records:e.records}})),ae(le,se.SET_CURRENT_CONVERSATION_ID,(function(e){return{conversationId:e.conversationId,previousId:e.previousId}})),ae(le,se.UPDATE_CONVERSATION_FILTER_REQUESTED,(function(e){return{filter:e.filter}})),ae(le,se.FETCH_CONVERSATIONS_TOTAL_COUNT_SUCCEEDED,(function(e){return{totalConversationsCount:e.totalConversationsCount}})),ae(le,se.UPDATE_SELECTION,(function(e){return e})),ae(le,se.UPDATE_BATCH_FORWARD,(function(e){return{groups:e.groups,members:e.members,noMatchMember:e.noMatchMember,multipleShop:e.multipleShop,conversationIds:e.conversationIds}})),ae(le,se.RESET_BATCH_FORWARD,(function(){return{}})),ae(le,se.INIT_CONVERSATION_REQUESTED,(function(e){return{from:e.from,callback:e.callback}})),ae(le,se.FETCH_DUE_DATA_LOOP,(function(){return{}})),ae(le,se.SET_PINNED_CONVERSATION_IDS,(function(e){return{pinnedConversationIds:e.pinnedConversationIds}})),le)),Ee=fe.deleteConversationRequested,_e=fe.deleteConversationSucceeded,ve=fe.getConversationDetailRequested,Se=fe.fakeConversationSucceeded,me=fe.fetchConversationsRequested,Oe=fe.fetchConversationsSucceeded,Te=fe.updateFetchConversationsStatus,ge=fe.updateFetchConversationsDirection,Re=fe.updateConversationFilter,Ce=(fe.forwardConversationRequested,fe.massForwardConversationRequested,fe.markMessagesRequested),Ie=fe.markMessagesSucceeded,he=fe.updateReadRequestData,Ne=fe.pinConversationRequested,be=(fe.selectedConversationsRequested,fe.conversationBatchOperateRequested,fe.setCurrentConversationCanRead),xe=fe.showConversationRequested,Ae=fe.resetConversationRequested,ye=fe.showConversationSucceeded,De=fe.changeConversationStatusRequested,we=fe.fetchDegradeConversationsDetail,ke=fe.conversationOperateRequested,Pe=fe.updateAccess,Me=fe.updateSyncTimeNow,Ue=fe.showNormalConversationSucceeded,je=fe.setNavigateToUnreadMessage,Fe=fe.setNavigateToUnreadMessageId,Ve=fe.resetNavigateToUnreadMessageId,Le=fe.locationMessage,He=fe.updateLocationMode,Ge=fe.setConversationBeenDeleted,Be=fe.muteConversationRequested,Qe=fe.getPendingOffersCountRequested,qe=fe.getPendingOffersCountSucceed,We=fe.getBatchPendingOffersCountSucceed,ze=fe.setCurrentConversationId,Ye=fe.updateConversationFilterRequested,Je=fe.fetchConversationsTotalCountSucceeded,Ke=(fe.updateBatchForward,fe.resetBatchForward,fe.setPinnedConversationIds),$e=fe.initConversationRequested,Xe=fe.fetchDueDataLoop,Ze=n(701).t,et=regeneratorRuntime.mark(nt),tt=regeneratorRuntime.mark(rt);function nt(e){var t,n,a,s,c,i,u,d;return regeneratorRuntime.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:return t=e.payload.conversationId,l.prev=1,l.next=4,(0,de.select)(P(t));case 4:return n=l.sent,a=n.shop_id,s=n.isPinned,c={method:"PUT",parent:"conversations",parentId:t,resource:s?"unpin":"pin"},a&&(c.payload=JSON.stringify({shop_id:a})),l.next=11,(0,de.call)(o.fetch,c);case 11:l.next=22;break;case 13:if(l.prev=13,l.t0=l.catch(1),"exceed_pinned_limit"!==l.t0.message){l.next=20;break}u=null===(i=l.t0.data)||void 0===i?void 0:i.pin_limit,d=ue().alarm({showClose:!1,title:Ze("common.alarm"),className:"chat-modal",content:Ze("message.max_pinned_chats_limited",{count:u}),confirmText:Ze("common.confirm"),onConfirm:function(){d.destroy()}}),l.next=22;break;case 20:return l.next=22,(0,de.put)((0,r.setToastInformation)({error:l.t0}));case 22:case"end":return l.stop()}}),et,null,[[1,13]])}function rt(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,de.takeEvery)(Ne,nt);case 2:case"end":return e.stop()}}),tt)}var ot=regeneratorRuntime.mark(st),at=regeneratorRuntime.mark(ct);function st(e){var t,n;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t=e.payload.conversationId,a.prev=1,a.next=4,(0,de.select)(M(t));case 4:return n=a.sent,a.next=7,(0,de.call)(o.fetch,{method:"DELETE",resource:"conversations",id:t,params:{shop_id:n}});case 7:a.next=13;break;case 9:return a.prev=9,a.t0=a.catch(1),a.next=13,(0,de.put)((0,r.setToastInformation)({error:a.t0}));case 13:case"end":return a.stop()}}),ot,null,[[1,9]])}function ct(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,de.takeEvery)(Ee,st);case 2:case"end":return e.stop()}}),at)}var it=ae({},se.DELETE_CONVERSATION_SUCCEEDED,r.deleteConversationSucceedHandler),ut=n(783);function dt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function lt(e,t){if(e){if("string"==typeof e)return dt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?dt(e,t):void 0}}function pt(e){return function(e){if(Array.isArray(e))return dt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||lt(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ft(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],s=!0,c=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);s=!0);}catch(e){c=!0,o=e}finally{try{s||null==n.return||n.return()}finally{if(c)throw o}}return a}}(e,t)||lt(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Et(e){return Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Et(e)}function _t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_t(Object(n),!0).forEach((function(t){ae(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_t(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var St=function(e,t,n){if(e){var r={};return e.forEach((function(e){r[e]=!0})),(0,pe.simpleEqualCheck)(n.slice(0,pe.persistLimit),e)?vt(vt({},t),{},{changed:!1}):{changed:!0,conversationIds:e,conversationIdsMap:r,lastConversationId:e[e.length-1]}}return null},mt=function(e){var t=e.previousConversationIds,n=e.fetchedConversationIds,r=e.direction,o=e.fakeConversationId,a=e.sortByWaitTime;switch(r){case"reset":if(o){var s=Array.isArray(n)?pt(n):[];return s.unshift(o),s}return n;case"latest":return a?t.filter((function(e){return!n.includes(e)})).concat(n):n.concat(t.filter((function(e){return!n.includes(e)})));case"older":return t.concat(n.filter((function(e){return!t.includes(e)})));default:return n}},Ot=function(e,t){Object.keys(t).forEach((function(n){"object"===Et(t[n])?t[n].validate()&&(e[n]=t[n].value):t[n]&&(e[n]=t[n])}))};function Tt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function gt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tt(Object(n),!0).forEach((function(t){ae(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Rt=regeneratorRuntime.mark(It),Ct=regeneratorRuntime.mark(ht);function It(e,t,n,a,s){var c,i,u,d,l,p,f,E,_,v,m,O,T,g,R;return regeneratorRuntime.wrap((function(I){for(;;)switch(I.prev=I.next){case 0:return c=(0,o.normalize)("conversations",e),I.next=3,(0,de.select)(N);case 3:return i=I.sent,I.next=6,(0,de.select)((function(e){return e.entityReducer}));case 6:return u=I.sent,d=u.conversations,l=void 0===d?{}:d,p=u.shops,f=void 0===p?{}:p,I.next=13,(0,de.select)(r.waitingTimeFilterSelector);case 13:return I.sent,I.next=16,(0,de.select)(C);case 16:return I.sent,E=[],i&&i.faking?(_=i.id,E=mt({previousConversationIds:t,fetchedConversationIds:c.result,direction:a,fakeConversationId:_,sortByWaitTime:!1})):E=mt({previousConversationIds:t,fetchedConversationIds:c.result,direction:a,sortByWaitTime:!1}),v=E.length<pe.persistLimit?null:pt(E).splice(0,pe.persistLimit),I.next=23,(0,de.put)((0,r.updateEntities)({entities:{persist:v}}));case 23:return I.next=25,(0,de.call)(r.updateOrReplaceAction,l,e,"conversations");case 25:return I.next=27,(0,de.spawn)(ht,e);case 27:if(!(m=s&&s.length)){I.next=33;break}return I.next=31,(0,de.call)(r.updateOrReplaceAction,f,s,"shops");case 31:return I.next=33,(0,de.put)((0,r.updateFetchedShopIds)({shopIds:s.map((function(e){return e.id}))}));case 33:return I.next=35,(0,de.put)((0,r.updateConversationListsHash)());case 35:if(!(O=St(v,n,t))||!O.changed){I.next=47;break}if(g=O.lastConversationId,"older"!==a&&"reset"!==a){I.next=42;break}T=c.entities.conversations&&c.entities.conversations[g],I.next=46;break;case 42:return I.next=44,(0,de.select)(S);case 44:R=I.sent,T=R.find((function(e){return e.id===g}));case 46:T&&(m?(O.oldestReceivedMessageId=T.latest_message_id,O.oldestMessageRegion=T.last_message_region):O.oldestTimestampNano=T.last_msg_time_nano);case 47:return I.abrupt("return",{persistObj:O,resultConversationIds:E});case 48:case"end":return I.stop()}}),Rt)}function ht(e){var t,n,a,s,c,i,u,d,l,p,f,E,_,v;return regeneratorRuntime.wrap((function(S){for(;;)switch(S.prev=S.next){case 0:if(t=[],e.forEach((function(e){(0,pe.hasTargetMessageOption)(e.last_message_option,pe.MessageOption.MSG_OPT_RECALL)&&t.push({conversation_id:e.id,shop_id:e.shop_id})})),!t.length){S.next=27;break}return S.next=5,(0,de.call)(o.fetch,{method:"POST",parent:"conversation",resource:"last_msg_in_conversation_batch",payload:JSON.stringify({pairs:t})});case 5:if(n=S.sent,!(a=Object.keys(n)).length){S.next=27;break}s={};case 9:if(!a.length){S.next=24;break}if(!(c=a.shift())){S.next=22;break}return S.next=14,(0,de.select)(P(c));case 14:if(i=S.sent,(0,pe.hasTargetMessageOption)(i.last_message_option,pe.MessageOption.MSG_OPT_RECALL)){S.next=17;break}return S.abrupt("continue",9);case 17:u=n[c],d=u.id,l=u.type,p=u.content,f=u.to_shop_id,E=u.created_at,_=(0,pe.getChatBotParams)(u,{updateMaxGeneralOptionHideTime:i.shop_id!==f}),v=(0,pe.getCrmPreviewParams)(u),s[c]=gt(gt({latest_message_id:d,latest_message_type:l,latest_message_content:p,last_message_time:E},_),v);case 22:S.next=9;break;case 24:if((0,pe.checkEmptyObject)(s)){S.next=27;break}return S.next=27,(0,de.put)((0,r.batchUpdateRecord)({name:"conversations",records:s}));case 27:case"end":return S.stop()}}),Ct)}var Nt=regeneratorRuntime.mark(yt);function bt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bt(Object(n),!0).forEach((function(t){ae(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var At=function(e){return e=e.filter((function(e){return e})),new Promise((function(t){(0,o.fetch)({parent:"setting",resource:"auto_translations",params:{shop_ids:JSON.stringify(e)}}).then((function(e){var n=e.auto_translations;t(void 0===n?[]:n)})).catch((function(){t([])}))}))};function yt(e){var t,n;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,(0,de.select)(r.autoTranslation);case 2:if("enabled"===o.sent){o.next=9;break}return t=Array.from(new Set(e.map((function(e){return e.to_shop_id})))),o.next=7,(0,de.call)(At,t);case 7:n=o.sent,e=e.map((function(e){var t=n.find((function(t){return t.shop_id===e.to_shop_id}));return xt(xt({},e),{},{translationAccess:!!t&&t.is_auto_translation})}));case 9:return o.abrupt("return",e);case 10:case"end":return o.stop()}}),Nt)}var Dt=regeneratorRuntime.mark(wt);function wt(e){var t,n,o;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t=[],n=[],a.next=4,(0,de.select)(r.fetchedShopIdsSelector);case 4:if(o=a.sent,e.forEach((function(e){!o.includes(e.shop_id)&&n.push(e.shop_id)})),!n.length){a.next=10;break}return a.next=9,(0,de.call)(r.fetchShopsByIds,{shopIds:pt(new Set(n))});case 9:t=a.sent;case 10:return a.abrupt("return",t);case 11:case"end":return a.stop()}}),Dt)}function kt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Pt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kt(Object(n),!0).forEach((function(t){ae(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Mt,Ut=regeneratorRuntime.mark(Ht),jt=regeneratorRuntime.mark(Gt),Ft=regeneratorRuntime.mark(Bt),Vt=regeneratorRuntime.mark(Qt),Lt=regeneratorRuntime.mark(qt);function Ht(){var e,t,n;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,(0,de.select)(C);case 2:return e=o.sent.toLowerCase(),t={},e&&["unread","unreplied"].includes(e)&&(t.type=e),o.next=7,(0,de.select)(r.isSubAccountSelector);case 7:return n=o.sent,o.abrupt("return",{parent:"".concat(n?"subaccount/conversations/pinned":"conversations/pinned"),resource:"list",params:t});case 9:case"end":return o.stop()}}),Ut)}function Gt(){var e,t,n;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,(0,de.put)(Ke({pinnedConversationIds:[]}));case 2:return o.next=4,(0,de.select)(r.conversationEntitiesSelector);case 4:if(e=o.sent,t=Object.keys(e),n={},t.length&&t.forEach((function(t){var r=null==e?void 0:e[t];null!=r&&r.isPinned&&(n[t]={isPinned:!1})})),!Object.keys(n).length){o.next=11;break}return o.next=11,(0,de.put)((0,r.batchUpdateRecord)({name:"conversations",records:n}));case 11:case"end":return o.stop()}}),jt)}function Bt(e){var t,n,o,a;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,de.call)(yt,e);case 2:return e=s.sent,s.next=5,(0,de.select)(r.isSubAccountSelector);case 5:if(!s.sent){s.next=18;break}return s.next=9,(0,de.call)(wt,e);case 9:if(null==(t=s.sent)||!t.length){s.next=18;break}return s.next=13,(0,de.select)(r.shopsEntitiesSelector);case 13:return n=s.sent,s.next=16,(0,de.call)(r.updateOrReplaceAction,n,t,"shops");case 16:return s.next=18,(0,de.put)((0,r.updateFetchedShopIds)({shopIds:t.map((function(e){return e.id}))}));case 18:return s.next=20,(0,de.select)(r.conversationEntitiesSelector);case 20:return o=s.sent,e=e.map((function(e){return Pt(Pt({},e),{},{isPinned:!0})})),s.next=24,(0,de.call)(r.updateOrReplaceAction,o,e,"conversations");case 24:return s.next=26,(0,de.spawn)(ht,e);case 26:return a=e.map((function(e){return e.id})),s.next=29,(0,de.put)(Ke({pinnedConversationIds:a}));case 29:return s.next=31,(0,de.spawn)(cn,e);case 31:return s.abrupt("return",e);case 32:case"end":return s.stop()}}),Ft)}function Qt(e){var t,n,r,a,s,c,i,u,d,l;return regeneratorRuntime.wrap((function(p){for(;;)switch(p.prev=p.next){case 0:return p.prev=0,n=(t=e||{}).direction,r=void 0===n?"reset":n,a=t.triggerBySync,s=void 0!==a&&a,p.next=4,(0,de.select)(C);case 4:if(c=p.sent.toLowerCase(),!s&&"older"!==r&&"pinned"!==c){p.next=7;break}return p.abrupt("return",[]);case 7:return p.next=9,(0,de.call)(Ht);case 9:return i=p.sent,p.next=12,(0,de.call)(o.fetch,i);case 12:return u=p.sent,d=u.list,l=void 0===d?[]:d,p.next=17,(0,de.call)(Gt);case 17:return p.next=19,(0,de.call)(Bt,l);case 19:return l=p.sent,p.abrupt("return",l);case 23:return p.prev=23,p.t0=p.catch(0),p.abrupt("return",[]);case 26:case"end":return p.stop()}}),Vt,null,[[0,23]])}function qt(e,t){var n;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(n={},e.length&&e.forEach((function(e){n[e.id]={isPinned:!0}})),!Object.keys(n).length){o.next=5;break}return o.next=5,(0,de.put)((0,r.batchUpdateRecord)({name:"conversations",records:n}));case 5:return o.next=7,(0,de.put)(Ke({pinnedConversationIds:pt(t)}));case 7:return o.abrupt("return",e);case 8:case"end":return o.stop()}}),Lt)}var Wt=regeneratorRuntime.mark(sn),zt=regeneratorRuntime.mark(cn),Yt=regeneratorRuntime.mark(dn),Jt=regeneratorRuntime.mark(ln),Kt=regeneratorRuntime.mark(pn),$t=regeneratorRuntime.mark(fn),Xt=regeneratorRuntime.mark(En),Zt=regeneratorRuntime.mark(_n);function en(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function tn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?en(Object(n),!0).forEach((function(t){ae(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):en(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var nn=["pinned","unreplied"],rn=function(e,t,n,r,a,s,c){var i={},u="older"===e?n:"latest"===e?r:"",d=nn.includes(a);return i.resource=d?"conversation/list":"conversations",i.params={next_timestamp_nano:u,direction:"latest"===e&&u?"latest":"older"},"unread"===a&&(i.params.unread_only=!0),d&&(i.params.type=a),new Promise((function(e,t){(0,o.fetch)(i).then((function(t){var n=t.conversations,r=void 0===n?[]:n,o=t.page_result,a=void 0===o?{}:o,s=t.attributions;e([r,a,void 0===s?{}:s])})).catch((function(e){t(e)}))}))},on=function(e){e.source;var t=e.filter,n=e.shopId,r=e.direction,a=e.oldestMessageRegion,s=e.latestMessageRegion,c=e.oldestReceivedMessageId,i=e.latestReceivedMessageId,u=e.subAccountNextTimestampNano,d=e.subAccountLastMessageNano,l=(e.hasSortParams,""),p="",f="";"older"===r?(l=a,p=c,f=u):"latest"===r&&(l=s,p=i,f=d);var E={direction:"latest"===r?"latest":"older"};return n&&(E.shop_id=n),l&&(E.last_message_region=l),p&&(E.last_received_message_id=p),E.next_timestamp_nano=f||0,t&&["unread","pinned","unreplied"].includes(t)&&(E.type=t),new Promise((function(e,t){(0,o.fetch)({parent:"subaccount",resource:"conversations",params:E}).then((function(t){var n=t.conversations,r=void 0===n?[]:n,o=t.attributions;e([r,void 0===o?{}:o])})).catch((function(e){t(e)}))}))},an=function(e){return new Promise((function(t,n){(0,o.fetch)({subServer:"coreapi",parent:"conversation_list_by_ids",params:{conversation_ids:JSON.stringify(e)}}).then((function(e){var n=e.conversations;t(void 0===n?[]:n)})).catch((function(e){n(e)}))}))};function sn(e){var t,n,a,s,c,i,u,d,l,p,f,E,_,v,S,m,O,T,g,R,C,I,h,N,b,x,A,y,D,w,k,P,U,j,F,V,L,H,G,B,Q,q,W,z,Y,J,K;return regeneratorRuntime.wrap((function($){for(;;)switch($.prev=$.next){case 0:return t=e.list,n=e.needFetchOfferCount,a=void 0!==n&&n,s=e.conversationId,c=e.handleSave,$.next=3,(0,de.select)(r.isSubAccountSelector);case 3:i=$.sent,u=[],d=[],l=[],p=[],f={},E=0;case 10:if(!(E<t.length)){$.next=26;break}if(_=t[E],v=_.id,S=_.conversation_id,m=_.type,O=_.content,T=_.latest_message_type,g=_.latest_message_content,R=_.to_id,C=_.shop_id,I=T||m,h=g||O,N=S||v,a&&p.push({buyer_id:R,shop_id:C}),!["order","offer","voucher"].includes(I)){$.next=23;break}return $.next=19,(0,de.select)(M(N));case 19:b=$.sent,x=!1,"order"===I&&i&&b!==h.shop_id&&(x=!0),x||(A="".concat(I,"_id"),y=h[A],D="order"===I?d:"offer"===I?u:l,0!==(w=h.shop_id)&&0!==parseInt(y)&&(D.push(ae({shop_id:w},A,parseInt(y))),f[v]={type:I,itemId:y,conversationId:N}));case 23:E++,$.next=10;break;case 26:if(Object.keys(f).length||p.length){$.next=28;break}return $.abrupt("return");case 28:return k={},$.next=31,(0,de.select)(r.currentUserShopIdSelector);case 31:if(P=$.sent){$.next=37;break}if(!s){$.next=37;break}return $.next=36,(0,de.select)(M(s));case 36:P=$.sent;case 37:return P&&(k={params:{shop_id:P}}),$.prev=38,$.next=41,(0,de.call)(o.fetch,tn(tn({method:"POST",parent:"chat_preview",resource:"detail"},k),{},{payload:JSON.stringify({offer_preview_req:u,order_preview_req:d,voucher_preview_req:l,offer_count_req:p})}));case 41:U=$.sent,$.next=47;break;case 44:$.prev=44,$.t0=$.catch(38),U={};case 47:if(F=(j=U).vouchers,V=void 0===F?[]:F,L=j.offers,H=void 0===L?[]:L,G=j.orders,B=void 0===G?[]:G,Q=j.buyer_offer_counts,q=void 0===Q?[]:Q,V.length||H.length||B.length||q.length){$.next=50;break}return $.abrupt("return");case 50:W={},z=Object.keys(f),Y=regeneratorRuntime.mark((function e(){var t,n,r,o,a,s,c,i,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=K[J],n=void 0,r=f[t],o=r.type,a=r.itemId,s=r.conversationId,e.next=5,(0,de.select)(ee(s));case 5:c=e.sent,e.t0=o,e.next="voucher"===e.t0?9:"offer"===e.t0?12:"order"===e.t0?15:17;break;case 9:return i=V.find((function(e){return e.id===a})),n=i?tn(tn({},i),{},{rule_text:(0,pe.formatRuleText)(i),discount_text:(0,pe.formatDiscountText)(i)}):i,e.abrupt("break",17);case 12:return u=H.find((function(e){return e.id===a})),n=u?tn(tn({},u),{},{offer_price:(0,pe.formatSinglePrice)(u.offer_price,c)}):u,e.abrupt("break",17);case 15:return n=B.find((function(e){return e.id===a})),e.abrupt("break",17);case 17:n&&(W[t]=n);case 18:case"end":return e.stop()}}),e)})),J=0,K=z;case 54:if(!(J<K.length)){$.next=59;break}return $.delegateYield(Y(),"t1",56);case 56:J++,$.next=54;break;case 59:c&&c({records:W,buyerOfferCounts:q});case 60:case"end":return $.stop()}}),Wt,null,[[38,44]])}function cn(e){var t,n;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return t={},n={},o.next=4,(0,de.call)(sn,{list:e,needFetchOfferCount:!0,handleSave:function(e){var r=e.records,o=e.buyerOfferCounts;Object.keys(r).forEach((function(e){t[e]={latest_message_content:r[e]}})),o.forEach((function(e){var t=e.shop_id,r=e.buyer_id,o=e.pending_count,a="".concat(t,"_").concat(r);n[a]=o}))}});case 4:return o.next=6,(0,de.put)((0,r.batchUpdateRecord)({name:"conversations",records:t}));case 6:return o.next=8,(0,de.put)(We({records:n}));case 8:case"end":return o.stop()}}),zt)}function un(e){var t=e.list,n=void 0===t?[]:t,r={},o=Date.now()*Math.pow(10,6);return n.forEach((function(e){var t="",n=e.due_attr,a=void 0===n?[]:n,s=e.id;if(null!=a&&a.length){var c=a.find((function(e){return 3===e.display_tag})).due_timestamp,i=a.find((function(e){return 2===e.display_tag})).due_timestamp,u=a.find((function(e){return 1===e.display_tag})).due_timestamp;o>=i&&o<c?t="overdue":o>=u&&o<i&&(t="duesoon")}r[s]={dueTag:t}})),r}function dn(e){var t,n,r,o,a,s,c,i,u,d,l,p,f,E,_,v,S,m,O,T,g,R;return regeneratorRuntime.wrap((function(C){for(;;)switch(C.prev=C.next){case 0:if(t=e.shouldFetchByTimestamp,n=e.direction,r=e.nextMessageTimeNano,o=e.oldestTimestampNano,a=e.storedLatestTimestampNano,s=e.conversationFilter,c=e.hasSortParams,i=e.source,u=e.shopId,d=e.oldestMessageRegion,l=e.latestMessageRegion,p=e.oldestReceivedMessageId,f=e.storedLatestReceivedMessageId,E=e.subAccountNextTimestampNano,_=e.subAccountLastMessageNano,v=[],S={},m={},!t){C.next=14;break}return C.next=7,(0,de.call)(rn,n,r,o,a,s,c,i);case 7:O=C.sent,T=ft(O,3),v=T[0],S=T[1],m=T[2],C.next=20;break;case 14:return C.next=16,(0,de.call)(on,{source:i,shopId:u,direction:n,oldestMessageRegion:d,latestMessageRegion:l,oldestReceivedMessageId:p,latestReceivedMessageId:f,filter:s,subAccountNextTimestampNano:E,subAccountLastMessageNano:_,hasSortParams:c});case 16:g=C.sent,R=ft(g,2),v=R[0],m=R[1];case 20:return C.abrupt("return",[v,S,m]);case 21:case"end":return C.stop()}}),Yt)}function ln(e){var t,n,a,s,c,i,u,d,l,p,f,E,_,v,S,m,O,T,g,R,I,h,N,b,x,A,y,D,w,k,P,M,U,j,F,V,L,H,G,B,Q,q,W,z,Y,J,K,$,X,Z,ee,te,ne,re,oe,ae,se,ce,ie,ue,le,fe,Ee,_e,ve,Se,ge,Re,Ce;return regeneratorRuntime.wrap((function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:return t=e.payload,n=t.direction,a=t.noPending,s=t.source,c=t.startChatErrorCallback,i="latest"===n,u=null,d=!1,l=!1,Ie.next=7,(0,de.select)(C);case 7:return p=Ie.sent.toLowerCase(),Ie.next=10,(0,de.select)(r.waitingTimeFilterSelector);case 10:return Ie.sent,Ie.next=13,(0,de.select)(r.isSubAccountSelector);case 13:return f=Ie.sent,Ie.next=16,(0,de.select)(r.showCrrDueSelector);case 16:if(Ie.sent,E=!f,_=s===pe.ConversationSource.SYNC,v="pinned"===p,"reset"!==n){Ie.next=27;break}return Ie.next=23,(0,de.put)((0,ut.resetConversationQueue)());case 23:return Ie.next=25,(0,de.put)(Oe({conversationIds:[],oldestMessageRegion:"",latestMessageRegion:"",oldestReceivedMessageId:"",latestReceivedMessageId:"",maxLatestReceivedMessageId:"",oldestTimestampNano:"",latestTimestampNano:"",maxLatestTimestampNano:"",direction:"reset",hasMore:!0,status:pe.DataFetchStatus.SUCCEED,persist:null,shouldFetchByTimestamp:E,subAccountNextTimestampNano:"",subAccountLastMessageNano:""}));case 25:return Ie.next=27,(0,de.call)(Gt);case 27:return Ie.next=29,(0,de.select)((function(e){return e.conversationReducer}));case 29:if(S=Ie.sent,m=S.oldestTimestampNano,O=S.latestTimestampNano,T=S.maxLatestTimestampNano,g=S.oldestReceivedMessageId,R=S.latestReceivedMessageId,I=S.maxLatestReceivedMessageId,h=S.hasMore,N=S.persist,b=S.conversationIds,x=S.status,A=S.syncFetchException,y=S.currentConversationId,D=S.oldestMessageRegion,w=S.latestMessageRegion,k=S.nextMessageTimeNano,P=S.subAccountNextTimestampNano,M=S.subAccountLastMessageNano,U="reset"===n||(E?!m:!g)&&"older"===n,Ie.prev=48,"older"===n&&(E?"0"===m:!h)){Ie.next=156;break}if(a){Ie.next=53;break}return Ie.next=53,(0,de.put)(Te({status:U?pe.DataFetchStatus.INIT_PENDING:pe.DataFetchStatus.PENDING}));case 53:return j=[],F={},Ie.next=59,(0,de.all)([(0,de.call)(dn,{shouldFetchByTimestamp:E,direction:n,nextMessageTimeNano:k,oldestTimestampNano:m,storedLatestTimestampNano:O,conversationFilter:p,hasSortParams:d,source:s,shopId:u,oldestMessageRegion:D,latestMessageRegion:w,oldestReceivedMessageId:g,storedLatestReceivedMessageId:R,subAccountNextTimestampNano:P,subAccountLastMessageNano:M}),(0,de.call)(Qt,{direction:n,triggerBySync:_})]);case 59:if(V=Ie.sent,L=ft(V,2),H=ft(L[0],3),j=H[0],F=H[1],H[2],L[1],!(G=j.length)){Ie.next=152;break}if("reset"===n&&(!E||nn.includes(p))){Ie.next=78;break}if(B=j[G-1],Q="older"===n,E?(q=Q?m:O,W=Q?B.next_timestamp_nano:B.last_message_time_nano):(q=Q?g:R,W=B.latest_message_id),!q||!W){Ie.next=78;break}if(Q?W<q:W>q){Ie.next=78;break}return Ie.next=77,(0,de.put)(Oe({direction:n,status:pe.DataFetchStatus.SUCCEED,hasMore:i,persist:N,oldestReceivedMessageId:g,latestReceivedMessageId:R,oldestMessageRegion:D,latestMessageRegion:w,maxLatestReceivedMessageId:R,conversationIds:b,oldestTimestampNano:m,latestTimestampNano:O,maxLatestTimestampNano:O,shouldFetchByTimestamp:E,subAccountNextTimestampNano:P,subAccountLastMessageNano:M}));case 77:return Ie.abrupt("return");case 78:return Ie.next=80,(0,de.call)(yt,j);case 80:if(j=Ie.sent,z={},j.forEach((function(e){z[e.id]=!0})),l||v?(J=pt(j),(0,r.sortConversations)(J),Y=J[0]):((0,r.sortConversations)(j),Y=j[0]),K=(0,r.getTimestamp)(Y,F.next_cursor),$=Y.latest_message_id,X={status:pe.DataFetchStatus.SUCCEED,direction:n,conversationIdsMap:z,shouldFetchByTimestamp:E,latestMessageRegion:Y.last_message_region,maxLatestReceivedMessageId:!I||I<$?$:I},!E){Ie.next=102;break}return te=K.oldestTimestampNano,ne=K.latestTimestampNano,Ie.next=91,(0,de.select)((function(e){return e.conversationReducer}));case 91:return re=Ie.sent,oe=re.conversationIds,ae=re.persist,Ie.next=96,(0,de.call)(It,j,oe,ae,n);case 96:se=Ie.sent,ce=se.persistObj,ie=se.resultConversationIds,X=Object.assign({},X,{sortByWaitTime:l,nextMessageTimeNano:null===(Z=F)||void 0===Z||null===(ee=Z.next_cursor)||void 0===ee?void 0:ee.next_message_time_nano,oldestTimestampNano:te,latestTimestampNano:ne,persist:ce,conversationIds:ie,maxLatestTimestampNano:!T||T<ne?ne:T}),Ie.next=115;break;case 102:return Ie.next=104,(0,de.call)(wt,j);case 104:return ue=Ie.sent,Ie.next=107,(0,de.select)((function(e){return e.conversationReducer}));case 107:return le=Ie.sent,fe=le.conversationIds,Ee=le.persist,Ie.next=112,(0,de.call)(It,j,fe,Ee,n,ue);case 112:_e=Ie.sent,ve=j[G-1],X=Object.assign({},X,{hasMore:!0,conversationIdsMap:z,persist:_e.persistObj,oldestMessageRegion:ve.last_message_region,oldestReceivedMessageId:ve.latest_message_id,latestReceivedMessageId:$,conversationIds:_e.resultConversationIds,subAccountNextTimestampNano:Y.next_timestamp_nano,subAccountLastMessageNano:Y.last_message_time_nano});case 115:if(!_){Ie.next=127;break}if(!y||!z[y]){Ie.next=127;break}return Se=j.find((function(e){return e.id===y})),ge=(Se||{}).latest_message_id,Ie.next=121,(0,de.select)(ko);case 121:if(Re=Ie.sent,Ce=Re.length?Re[Re.length-1].id:"",ge===Ce){Ie.next=127;break}return Ie.next=127,(0,de.put)((0,ut.fetchMessagesRequested)({conversationId:null==Se?void 0:Se.id,reset:!0}));case 127:return Ie.next=129,(0,de.put)(Oe(X));case 129:return Ie.next=131,(0,de.spawn)(cn,j);case 131:if(!v){Ie.next=134;break}return Ie.next=134,(0,de.call)(qt,j,X.conversationIds);case 134:if(!i){Ie.next=147;break}if(!E){Ie.next=143;break}if("0"===K.nextTimestampNano){Ie.next=141;break}return Ie.next=139,(0,de.put)(me({direction:n,noPending:!0}));case 139:Ie.next=141;break;case 141:Ie.next=145;break;case 143:return Ie.next=145,(0,de.put)(me({direction:n,noPending:!0}));case 145:Ie.next=150;break;case 147:if(!(X.conversationIds.length<=20)){Ie.next=150;break}return Ie.next=150,(0,de.put)(me({direction:"older",noPending:!0}));case 150:Ie.next=154;break;case 152:return Ie.next=154,(0,de.put)(Oe({direction:n,status:pe.DataFetchStatus.SUCCEED,hasMore:i,persist:N,oldestReceivedMessageId:g,latestReceivedMessageId:R,oldestMessageRegion:D,latestMessageRegion:w,maxLatestReceivedMessageId:I,oldestTimestampNano:m,latestTimestampNano:O,maxLatestTimestampNano:T,shouldFetchByTimestamp:E,syncFetchException:_?A+1:0,nextMessageTimeNano:k,subAccountNextTimestampNano:P,subAccountLastMessageNano:M}));case 154:Ie.next=159;break;case 156:if(x===pe.DataFetchStatus.INIT_FAILED){Ie.next=159;break}return Ie.next=159,(0,de.put)(Te({status:pe.DataFetchStatus.SUCCEED}));case 159:Ie.next=171;break;case 161:if(Ie.prev=161,Ie.t0=Ie.catch(48),c&&c(pe.StartChatErrorCode.Conversations),!(Ie.t0 instanceof o.TemporyError||Ie.t0 instanceof o.NotFound)){Ie.next=169;break}return Ie.next=167,(0,de.put)(Te({status:pe.DataFetchStatus.TEMPORY_ERROR}));case 167:Ie.next=171;break;case 169:return Ie.next=171,(0,de.put)(Te({status:U?pe.DataFetchStatus.INIT_FAILED:pe.DataFetchStatus.FAILED}));case 171:case"end":return Ie.stop()}}),Jt,null,[[48,161]])}function pn(e){var t,n,o,a,s;return regeneratorRuntime.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:if(t=e.payload.conversationIds,n=void 0===t?[]:t,c.prev=1,n.length){c.next=6;break}return c.next=5,(0,de.select)(R);case 5:n=c.sent;case 6:if(!n.length){c.next=16;break}return c.next=9,(0,de.call)(an,n.slice(0,20));case 9:if(o=c.sent,!(a=o.filter((function(e){return!e.lack}))).length){c.next=16;break}return s={},a.forEach((function(e){s[e.id]=e})),c.next=16,(0,de.put)((0,r.batchUpdateRecord)({name:"conversations",records:s}));case 16:c.next=20;break;case 18:c.prev=18,c.t0=c.catch(1);case 20:case"end":return c.stop()}}),Kt,null,[[1,18]])}function fn(e){var t,n,r,a,s;return regeneratorRuntime.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return t=e.payload,n=t.shopId,r=t.buyerId,c.prev=1,c.next=4,(0,de.call)(o.fetch,{parent:"offer",resource:"count",params:{shop_id:n,buyer_id:r}});case 4:return a=c.sent,s=a.pending_count,c.next=8,(0,de.put)(qe({shopId:n,buyerId:r,count:s}));case 8:c.next=14;break;case 10:return c.prev=10,c.t0=c.catch(1),c.next=14,(0,de.put)(qe({shopId:n,buyerId:r,count:0}));case 14:case"end":return c.stop()}}),$t,null,[[1,10]])}function En(){var e,t,n,r,a,s,c,i;return regeneratorRuntime.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,e={},u.next=4,(0,de.call)(o.fetch,{parent:"conversation",resource:"attr",params:e});case 4:return t=u.sent,n=t.attributes,r=n.total_unreplied_conv_count,a=n.total_due_soon_conv_count,s=n.total_over_due_conv_count,c=n.total_pinned_conv_count,i=n.total_unread_conv_count,u.next=9,(0,de.put)(Je({totalConversationsCount:{unrepliedCount:r,duesoonCount:a,overdueCount:s,pinnedCount:c,unreadCount:i}}));case 9:u.next=13;break;case 11:u.prev=11,u.t0=u.catch(0);case 13:case"end":return u.stop()}}),Xt,null,[[0,11]])}function _n(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,de.takeEvery)(me,ln);case 2:return e.next=4,(0,de.takeEvery)(we,pn);case 4:return e.next=6,(0,de.takeEvery)(Qe,fn);case 6:case"end":return e.stop()}}),Zt)}var vn,Sn=(ae(Mt={},se.FETCH_CONVERSATIONS_SUCCEEDED,(function(e,t){var n=t.payload,r=n.conversationIds,o=n.conversationIdsMap,a=void 0===o?{}:o,s=n.oldestMessageRegion,c=n.latestMessageRegion,i=n.oldestReceivedMessageId,u=n.latestReceivedMessageId,d=n.direction,l=void 0===d?"reset":d,p=n.status,f=n.hasMore,E=n.oldestTimestampNano,_=n.latestTimestampNano,v=n.persist,S=n.shouldFetchByTimestamp,m=n.maxLatestReceivedMessageId,O=n.maxLatestTimestampNano,T=n.syncFetchException,g=void 0===T?0:T,R=n.nextMessageTimeNano,C=n.sortByWaitTime,I=n.subAccountNextTimestampNano,h=n.subAccountLastMessageNano,N=tn(tn({},e),{},{status:p,hasMore:f,persist:v,conversationIds:r||e.conversationIds,conversationIdsMap:"reset"===l?a:tn(tn({},e.conversationIdsMap),a),direction:"latest"===l?l:"older",maxLatestReceivedMessageId:m,maxLatestTimestampNano:O,syncFetchException:g,nextMessageTimeNano:R});switch(l){case"reset":S?(N.latestTimestampNano=_,N.oldestTimestampNano=E):(N.oldestReceivedMessageId=i,N.latestReceivedMessageId=u,N.subAccountNextTimestampNano=I,N.subAccountLastMessageNano=h);break;case"latest":S?N.latestTimestampNano=_>e.latestTimestampNano?_:e.latestTimestampNano:(N.latestReceivedMessageId=u,N.subAccountLastMessageNano=h);break;case"older":S?(N.oldestTimestampNano=E,C&&(N.latestTimestampNano=_)):(N.oldestReceivedMessageId=i,N.subAccountNextTimestampNano=I)}return s&&(N.oldestMessageRegion=s),c&&(N.latestMessageRegion=c),N})),ae(Mt,se.UPDATE_FETCH_CONVERSATIONS_STATUS,(0,r.pureActionHandler)()),ae(Mt,se.UPDATE_FETCH_CONVERSATIONS_DIRECTION,(0,r.pureActionHandler)()),ae(Mt,se.UPDATE_CONVERSATION_TIMESTAMP,(0,r.pureActionHandler)()),ae(Mt,se.GET_PENDING_OFFERS_COUNT_SUCCEED,(function(e,t){var n=t.payload,r=n.shopId,o=n.buyerId,a=n.count,s="".concat(r,"_").concat(o);return tn(tn({},e),{},{pendingOffersCount:tn(tn({},e.pendingOffersCount),{},ae({},s,a))})})),ae(Mt,se.GET_BATCH_PENDING_OFFERS_COUNT_SUCCEED,(function(e,t){var n=t.payload.records;return tn(tn({},e),{},{pendingOffersCount:tn(tn({},e.pendingOffersCount),n)})})),ae(Mt,se.FETCH_CONVERSATIONS_TOTAL_COUNT_SUCCEEDED,(0,r.pureActionHandler)()),ae(Mt,se.SET_PINNED_CONVERSATION_IDS,(function(e,t){var n=t.payload.pinnedConversationIds;return tn(tn({},e),{},{pinnedConversationIds:n||e.pinnedConversationIds})})),Mt),mn=regeneratorRuntime.mark(Nn),On=regeneratorRuntime.mark(bn),Tn=regeneratorRuntime.mark(xn),gn=regeneratorRuntime.mark(An),Rn=regeneratorRuntime.mark(yn),Cn=regeneratorRuntime.mark(Dn);function In(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function hn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?In(Object(n),!0).forEach((function(t){ae(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):In(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Nn(e){var t,n,r,a,s,c,i,u,d,l,p,f,E;return regeneratorRuntime.wrap((function(_){for(;;)switch(_.prev=_.next){case 0:if(t=e.conversation,n=e.isSubAccount,r=t.id,a=t.to_id,s={},n){_.next=8;break}return _.next=6,(0,de.call)(pe.getItem,"mini-sc_redirect");case 6:(c=_.sent)&&(i=c.orderId,u=c.productId,d=c.conversationId,l=c.shopId,parseInt(r)===parseInt(d)&&(i?s={order_id:parseInt(i)}:u?s={product_id:parseInt(u)}:l&&(s={shop_id:parseInt(l)})));case 8:return _.next=10,(0,de.call)(o.fetch,{method:"POST",parent:"conversation",resource:"enter",payload:JSON.stringify(hn({conversation_id:r,to_id:a},s))});case 10:if(p=_.sent,f=p.faq_session_id,E=p.session_expiry_timestamp,n){_.next=16;break}return _.next=16,(0,de.put)((0,ut.fetchFaqSessionSucceed)({conversationId:r,faqSessionId:f,sessionExpiryTime:E}));case 16:case"end":return _.stop()}}),mn)}function bn(e){var t,n,a,s,c,i,u,d,l,p,f,E,_,v,S,m,O,T,g,R,C,I,h,N,b,x,A,y;return regeneratorRuntime.wrap((function(D){for(;;)switch(D.prev=D.next){case 0:return t=e.conversation,e.previousId,n=e.messageId,a=e.messageList,s=e.startChatErrorCallback,e.sourceInfo,i=(c=t).id,u=c.lack,D.next=4,(0,de.select)(r.isSubAccountSelector);case 4:if((d=D.sent)||!u){D.next=11;break}return D.next=8,(0,de.call)(pn,{payload:{conversationIds:[i]}});case 8:return D.next=10,(0,de.select)(P(i));case 10:t=D.sent;case 11:return p=(l=t).faking,f=l.status,E=l.to_id,_=l.shop_id,v=l.latest_message_id,S=l.to_shop_id,m=l.unread_count,O=l.last_read_message_id,(0,o.$tracker)({shopId:_,operation:pe.TrackerOperation.IMPRESSION,section:"conversation_window",data:{convo_userid:E,conversation_id:i}}),D.next=15,(0,de.spawn)(Nn,{conversation:t,isSubAccount:d});case 15:return D.next=17,(0,de.select)(r.shopTranslationSettingsSelector);case 17:if((T=D.sent)&&T[_]||!d){D.next=22;break}return D.next=22,(0,de.call)(r.fetchShopSettings,(0,r.fetchShopTranslationSettings)({shopId:_}));case 22:return D.next=24,(0,de.put)((0,r.showUserRequested)({userId:E,shopId:_,buyerShopId:S}));case 24:return D.next=26,(0,de.put)(Ve());case 26:return g="number"==typeof m&&m>0&&!n,D.next=29,(0,de.put)(je({isNavigateToUnreadMessage:g}));case 29:return D.next=31,(0,de.put)((0,ut.fetchMessagesRequested)({conversationId:i,messageId:n||(g?O:void 0),direction:n||g?"around":"older",messageList:a,startChatErrorCallback:s,reset:!0}));case 31:return D.next=33,(0,de.put)(Qe({shopId:_,buyerId:E}));case 33:return D.next=35,(0,de.call)(ut.handleCurrentConversationChange,i);case 35:if(R=D.sent,!(!p&&"closed"!==f&&m>0||R)){D.next=41;break}return C=R||v,D.next=41,(0,de.put)(Ce({conversationId:i,isRead:!0,latestMessageId:C}));case 41:if(I={},!d){D.next=50;break}return D.next=45,(0,de.call)(r.fetchShopAuth,{payload:{shopId:_}});case 45:return h=D.sent,N=h.auth_names,b=void 0===N?[]:N,D.next=50,(0,de.put)(Pe({access:b}));case 50:return D.next=52,(0,de.select)((0,r.shopSelector)(_));case 52:if(I=D.sent){D.next=59;break}return D.next=56,(0,de.call)(r.showShop,{payload:{shopId:_}});case 56:return I=D.sent,D.next=59,(0,de.put)((0,r.updateRecord)({name:"shops",id:_,record:hn({},I)}));case 59:if(!d){D.next=70;break}return D.next=62,(0,de.select)(r.hasVerifyPhoneNumberSelector);case 62:return x=D.sent,D.next=65,(0,de.select)(ko);case 65:if(A=D.sent,y=A.find((function(e){return e.errorCode===pe.MessageErrorCode.UNVERIFIED_PHONE_NUMBER})),x[_]||!y){D.next=70;break}return D.next=70,(0,de.spawn)(r.checkUserVerifyStatus,_);case 70:return D.next=74,(0,de.put)((0,ut.messageSyncUpdate)({conversation:t}));case 74:return D.next=76,(0,de.put)(Ge({conversationBeenDeleted:!1}));case 76:case"end":return D.stop()}}),On)}function xn(e){var t,n,r,o,a,s,c,i;return regeneratorRuntime.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:return t=e.payload,n=t.conversation,r=t.previousId,o=t.messageId,a=t.messageList,s=t.startChatErrorCallback,c=t.sourceInfo,i=void 0===c?{}:c,u.prev=1,u.next=4,(0,de.spawn)(bn,{conversation:n,previousId:r,messageId:o,messageList:a,startChatErrorCallback:s,sourceInfo:i});case 4:u.next=9;break;case 6:u.prev=6,u.t0=u.catch(1),console.log("*** Show Conversation Failed: ",u.t0);case 9:case"end":return u.stop()}}),Tn,null,[[1,6]])}function An(e){var t,n,r;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.payload,n=t.conversationId,r=t.previousId,o.next=3,(0,de.put)(ye({conversationId:n,previousId:r}));case 3:case"end":return o.stop()}}),gn)}function yn(e){var t,n,r;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return(t=e.payload).type,n=t.conversationId,r=t.previousId,o.next=4,(0,de.put)(Ue({conversationId:n,previousId:r}));case 4:case"end":return o.stop()}}),Rn)}function Dn(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,de.takeLatest)(xe,xn);case 2:return e.next=4,(0,de.takeEvery)(ze,An);case 4:return e.next=6,(0,de.takeEvery)(ye,yn);case 6:case"end":return e.stop()}}),Cn)}var wn=(ae(vn={},se.SHOW_NORMAL_CONVERSATION_SUCCEEDED,(function(e,t){var n=t.payload,r=n.conversationId;return n.previousId,hn(hn({},e),{},{currentConversationId:r})})),ae(vn,se.RESET_CONVERSATION_REQUESTED,(function(e){return hn(hn({},e),{},{currentConversationId:null})})),ae(vn,se.SET_NAVIGATE_TO_UNREAD_MESSAGE,(0,r.pureActionHandler)()),ae(vn,se.SET_NAVIGATE_TO_UNREAD_MESSAGE_ID,(0,r.pureActionHandler)()),ae(vn,se.RESET_NAVIGATE_TO_UNREAD_MESSAGE_ID,(function(e){return hn(hn({},e),{},{navigateToUnreadMessageId:""})})),vn),kn=regeneratorRuntime.mark(Mn),Pn=regeneratorRuntime.mark(Un);function Mn(e){var t,n;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.payload.filter,o.prev=1,o.next=4,(0,de.select)(r.currentUserSelector);case 4:return n=o.sent,pe.LS.setItem("mini-filter",JSON.stringify({filter:t,userid:n.id})),o.next=8,(0,de.put)(Re({filter:t}));case 8:o.next=12;break;case 10:o.prev=10,o.t0=o.catch(1);case 12:case"end":return o.stop()}}),kn,null,[[1,10]])}function Un(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,de.takeEvery)(Ye,Mn);case 2:case"end":return e.stop()}}),Pn)}var jn,Fn=ae({},se.UPDATE_CONVERSATION_FILTER,(0,r.pureActionHandler)()),Vn=ae({},se.SET_CURRENT_CONVERSATION_CAN_READ,(0,r.pureActionHandler)()),Ln=regeneratorRuntime.mark(Hn);function Hn(e,t,n){var o,a,s,c,i;return regeneratorRuntime.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,(0,de.select)(oe);case 2:return o=u.sent,a="api"===n?"socket"===o:"api"===o,u.next=6,(0,de.put)(Ie({conversationId:e,markType:a?"":"api"}));case 6:if(a){u.next=16;break}return u.next=9,(0,de.select)(P(e));case 9:return s=u.sent,c=s.unread_count,i=s.shop_id,u.next=14,(0,de.put)((0,r.updateRecord)({name:"conversations",id:e,record:{last_read_message_id:t,unread_count:0}}));case 14:return u.next=16,(0,de.put)((0,ut.updateUnreadCount)({type:r.unreadCountActions.MARK_AS_READ,conversation:{id:e,shop_id:i,unread_count:c}}));case 16:case"end":return u.stop()}}),Ln)}var Gn=regeneratorRuntime.mark(Wn),Bn=regeneratorRuntime.mark(zn);function Qn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function qn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qn(Object(n),!0).forEach((function(t){ae(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Wn(e){var t,n,a,s,c,i,u,d,l,p;return regeneratorRuntime.wrap((function(f){for(;;)switch(f.prev=f.next){case 0:return t=e.payload,n=t.conversationId,a=t.isRead,s=t.latestMessageId,f.prev=1,c=Date.now()+"",f.next=5,(0,de.select)(P(n));case 5:if(i=f.sent,u=i.shop_id,d=i.unread_count,l=i.last_read_message_id,!a||l!==s||d){f.next=11;break}return f.abrupt("return");case 11:if(p=a?{last_read_message_id:s}:{},u&&(p.shop_id=u),!a){f.next=16;break}return f.next=16,(0,de.put)(he({requestId:c}));case 16:return f.next=18,(0,de.call)(o.fetch,{method:"PUT",parent:"conversations",parentId:n,resource:a?"read":"unread",params:{request_id:c},payload:JSON.stringify(qn({},p))});case 18:if(!a){f.next=21;break}return f.next=21,(0,de.call)(Hn,n,s,"api");case 21:f.next=27;break;case 23:return f.prev=23,f.t0=f.catch(1),f.next=27,(0,de.put)((0,r.setToastInformation)({error:f.t0}));case 27:case"end":return f.stop()}}),Gn,null,[[1,23]])}function zn(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,de.takeEvery)(Ce,Wn);case 2:case"end":return e.stop()}}),Bn)}var Yn=(ae(jn={},se.MARK_MESSAGES_SUCCEEDED,(function(e,t){var n=t.payload,r=n.conversationId,o=n.markType;return qn(qn({},e),{},{conversationMark:qn(qn({},e.conversationMark),{},ae({},r,o))})})),ae(jn,se.UPDATE_READ_REQUEST_DATA,(function(e,t){var n=t.payload,r=n.requestId,o=n.requestIds,a=n.count,s=qn({},e);return r&&(s.readRequestIds=[r].concat(e.readRequestIds)),o&&(s.readRequestIds=o),a&&(s.missedReadNoticeCount=a),s})),jn),Jn=regeneratorRuntime.mark($n),Kn=regeneratorRuntime.mark(Xn);function $n(e){var t,n,a,s;return regeneratorRuntime.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:t=e.payload.conversationId,c.prev=1,c.next=7;break;case 7:return c.next=9,(0,de.select)(P(t));case 9:return n=c.sent,a=n.shop_id,s=n.status,c.next=14,(0,de.call)(o.fetch,{method:"PUT",resource:"conversations",id:t,suffix:"status",payload:JSON.stringify({shop_id:a,status:"activated"===s?"closed":"activated"})});case 14:c.next=20;break;case 16:return c.prev=16,c.t0=c.catch(1),c.next=20,(0,de.put)((0,r.setToastInformation)({error:c.t0}));case 20:case"end":return c.stop()}}),Jn,null,[[1,16]])}function Xn(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,de.takeEvery)(De,$n);case 2:case"end":return e.stop()}}),Kn)}var Zn=regeneratorRuntime.mark(tr),er=regeneratorRuntime.mark(nr);function tr(e){var t,n,a,s,c,i,u,d,l,f,E,_,v;return regeneratorRuntime.wrap((function(S){for(;;)switch(S.prev=S.next){case 0:return t=e.payload.conversationId,S.prev=1,S.next=4,(0,de.select)(P(t));case 4:return n=S.sent,a=n.id,s=n.unread_count,c=n.shop_id,S.next=8,(0,de.select)(p);case 8:return i=S.sent,S.next=11,(0,de.call)(o.fetch,{resource:"conversations",id:t,params:{shop_id:c}});case 11:if(u=S.sent,d=u.flag,l=u.entry_point,f=u.unread_count,E=u.latest_message_id,a){S.next=19;break}return _=(0,o.normalize)("conversations",u),v=_.entities,S.next=17,(0,de.put)((0,r.updateEntities)({entities:v}));case 17:S.next=21;break;case 19:return S.next=21,(0,de.put)((0,r.updateRecord)({name:"conversations",id:t,record:{flag:d,entry_point:l,unread_count:f}}));case 21:if(s||s===u.unread_count){S.next=24;break}return S.next=24,(0,de.put)((0,ut.updateUnreadCount)({conversation:u,type:r.unreadCountActions.ACTIVE_CONVERSATION}));case 24:if(t!==i){S.next=28;break}if(!(f>0)){S.next=28;break}return S.next=28,(0,de.put)(Ce({conversationId:t,isRead:!0,latestMessageId:E}));case 28:return S.abrupt("return",u);case 31:return S.prev=31,S.t0=S.catch(1),S.abrupt("return",{});case 34:case"end":return S.stop()}}),Zn,null,[[1,31]])}function nr(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,de.takeEvery)(ve,tr);case 2:case"end":return e.stop()}}),er)}function rr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function or(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rr(Object(n),!0).forEach((function(t){ae(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ar=ae({},se.FAKE_CONVERSATION_SUCCEEDED,(function(e,t){var n=t.payload.conversationId;return or(or({},e),{},{conversationIds:[n].concat(e.conversationIds.filter((function(e){return n!==e})))})})),sr=regeneratorRuntime.mark(lr),cr=regeneratorRuntime.mark(pr);function ir(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ur(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ir(Object(n),!0).forEach((function(t){ae(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ir(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var dr={restart:De,delete:Ee,read:Ce,unread:Ce,pin:Ne,unpin:Ne,mute:Be,unmute:Be};function lr(e){var t,n,r,o;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t=e.payload,n=t.type,r=t.extra,o=dr[n],a.next=4,(0,de.put)(o(ur({},r)));case 4:case"end":return a.stop()}}),sr)}function pr(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,de.takeEvery)(ke,lr);case 2:case"end":return e.stop()}}),cr)}function fr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Er(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fr(Object(n),!0).forEach((function(t){ae(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}dr.close=De;var _r={hasSCAccess:"login_sellercenter",hasEditOrderAccess:"webchat_order_edit",hasViewOrderAccess:"access_my_sale",hasViewProductAccess:"access_my_product",hasEditVoucherAccess:"my_marketing_voucher_edit",hasViewVoucherAccess:"my_marketing_voucher_access",hasViewRrOrderAccess:"access_rr_detail",hasOrderDetailAccess:"access_order_detail"},vr=function(e){var t={},n=e.length;return Object.keys(_r).forEach((function(r){t[r]=!n||e.includes(_r[r])})),t},Sr=ae({},se.UPDATE_ACCESS,(function(e,t){var n=vr(t.payload.access);return Er(Er({},e),{},{access:n})})),mr=regeneratorRuntime.mark(Or);function Or(){var e,t,n,a,s,c,i,u;return regeneratorRuntime.wrap((function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,(0,de.select)(l);case 2:return e=d.sent,d.prev=3,d.next=6,(0,de.call)(o.fetch,{subServer:"coreapi",parent:"conversation",resource:"updated_conversation_list",params:{last_update_time:e}});case 6:if(t=d.sent,n=t.conversations,a=t.page_result,!(n.length>0)){d.next=13;break}return s={},n.forEach((function(e){s[e.id]=e})),d.next=13,(0,de.put)((0,r.batchUpdateRecord)({name:"conversations",records:s}));case 13:if(i=(c=a||{}).has_more,!(u=c.next_last_update_time)){d.next=17;break}return d.next=17,(0,de.put)(Me({updateTimeNow:u}));case 17:if(!(i&&n.length>0)){d.next=20;break}return d.next=20,(0,de.call)(Or);case 20:d.next=29;break;case 22:if(d.prev=22,d.t0=d.catch(3),!(d.t0 instanceof o.CustomError)){d.next=29;break}return d.next=27,(0,de.put)(Me({updateTimeNow:"0"}));case 27:return d.next=29,(0,de.call)(ln,{payload:{direction:"reset"}});case 29:case"end":return d.stop()}}),mr,null,[[3,22]])}var Tr,gr,Rr=ae({},se.UPDATE_SYNC_TIME_NOW,(0,r.pureActionHandler)()),Cr=regeneratorRuntime.mark(hr),Ir=regeneratorRuntime.mark(Nr);function hr(e){var t,n,a,s,c,i;return regeneratorRuntime.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:return t=e.payload.conversationId,u.prev=1,u.next=4,(0,de.select)(P(t));case 4:return n=u.sent,a=n.shop_id,s=n.mute,u.next=9,(0,de.select)(r.isSubAccountSelector);case 9:return c=u.sent,Ot(i={biz_type:c?2:0},{shop_id:a}),u.next=14,(0,de.call)(o.fetch,{method:"PUT",parent:"conversations",parentId:t,resource:s?"unmute":"mute",payload:JSON.stringify(i)});case 14:u.next=20;break;case 16:return u.prev=16,u.t0=u.catch(1),u.next=20,(0,de.put)((0,r.setToastInformation)({error:u.t0}));case 20:case"end":return u.stop()}}),Cr,null,[[1,16]])}function Nr(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,de.takeEvery)(Be,hr);case 2:case"end":return e.stop()}}),Ir)}var br=regeneratorRuntime.mark(Mr),xr=regeneratorRuntime.mark(Ur);function Ar(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ar(Object(n),!0).forEach((function(t){ae(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ar(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Dr=(0,ce.createActions)((ae(Tr={},se.SEARCH_CONVERSATIONS_REQUESTED,(function(e){var t=e.keyword,n=void 0===t?"":t,r=e.shopId;return{keyword:n,shopId:void 0===r?"":r}})),ae(Tr,se.SEARCH_CONVERSATIONS_SUCCEEDED,(function(e){return{results:e.results,searchStatus:e.searchStatus}})),ae(Tr,se.UPDATE_SEARCH_PARAMS,(function(e){var t=e.keyword;return{keyword:void 0===t?"":t,searchStatus:e.searchStatus}})),Tr)),wr=Dr.searchConversationsRequested,kr=Dr.searchConversationsSucceeded,Pr=Dr.updateSearchParams;function Mr(e){var t,n,r,o,a,s;return regeneratorRuntime.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return t=e.payload.keyword,n=[],r=t.trim(),c.next=5,(0,de.put)(Pr({keyword:r,searchStatus:pe.DataFetchStatus.INIT_PENDING}));case 5:if(!r){c.next=15;break}return o=r.toLocaleLowerCase(),c.next=9,(0,de.select)((function(e){return e.entityReducer}));case 9:return a=c.sent,s=a.shops,c.next=13,(0,de.select)(S);case 13:c.sent.forEach((function(e){(e.to_name||"").toLocaleLowerCase().includes(o)&&!e.faking&&n.push(yr(yr({},e),{},{shop_name:(s[e.shop_id]||{}).name}))}));case 15:return c.next=17,(0,de.put)(kr({results:n,searchStatus:pe.DataFetchStatus.SUCCEED}));case 17:case"end":return c.stop()}}),br)}function Ur(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,de.takeLatest)(wr,Mr);case 2:case"end":return e.stop()}}),xr)}var jr,Fr=(ae(gr={},se.SEARCH_CONVERSATIONS_SUCCEEDED,(function(e,t){var n=t.payload,r=n.results,o=n.searchStatus;return yr(yr({},e),{},{results:r,searchStatus:o})})),ae(gr,se.UPDATE_SEARCH_PARAMS,(function(e,t){var n=t.payload,r=n.keyword,o=n.searchStatus;return yr(yr({},e),{},{keyword:r,searchStatus:o})})),gr),Vr=n(701).t,Lr=regeneratorRuntime.mark(Br),Hr=regeneratorRuntime.mark(Qr);function Gr(e,t){return(0,o.fetch)({parent:"conversation",resource:"conversation_info",params:{shop_id:t,message_id:e}})}function Br(e){var t,n,a,s,c,i,u,d,l,p,f,E,_,v,S,m,O,T;return regeneratorRuntime.wrap((function(g){for(;;)switch(g.prev=g.next){case 0:return t=e.payload,n=t.msgId,a=t.shopId,g.next=3,(0,de.select)(ko);case 3:return s=g.sent,c={},i=s.find((function(e){return e.id===n})),g.next=8,(0,de.put)(He({inlocation:!0}));case 8:if(!i){g.next=16;break}return u=i.conversation_id,g.next=12,(0,de.select)(P(u));case 12:return c=g.sent,g.next=15,(0,de.call)(xn,{payload:{conversation:c,messageId:n,messageList:[]}});case 15:o.EventBus.emit("scrollToMessage",n);case 16:if(c.id){g.next=58;break}return g.prev=17,g.next=20,(0,de.all)([(0,de.call)(Gr,n,a),(0,de.call)(ut.fetchConversationMessagesSaga,{msgId:n,shopId:a})]);case 20:if(d=g.sent,l=ft(d,2),p=l[0],f=l[1],E=(p||{}).conversation_info,_=void 0===E?[]:E,v=(f||{}).get_messages,0!==(S=void 0===v?[]:v).length&&S.find((function(e){return e.id===n}))){g.next=28;break}throw new Error("message_not_found");case 28:if(!(c=_[0])){g.next=39;break}return m=(0,o.normalize)("conversations",c),O=m.entities,g.next=33,(0,de.put)((0,ut.deleteConversationMessageHash)({conversationId:c.id}));case 33:return g.next=35,(0,de.put)((0,r.updateEntities)({entities:O}));case 35:return g.next=37,(0,de.delay)(300);case 37:return g.next=39,(0,de.call)(xn,{payload:{conversation:c,messageId:n,messageList:S}});case 39:g.next=58;break;case 41:g.prev=41,g.t0=g.catch(17),T=Vr("common.server_error.warning_tips"),g.t1=g.t0.message,g.next="message_not_found"===g.t1?47:"conversation_not_found"===g.t1?49:55;break;case 47:return T=Vr("message.server_error.not_found"),g.abrupt("break",56);case 49:return T=Vr("conversation.server_error.deleted"),g.next=52,(0,de.put)(Ge({conversationBeenDeleted:!0}));case 52:return g.next=54,(0,de.put)(Ae());case 54:case 55:return g.abrupt("break",56);case 56:return g.next=58,(0,de.call)(r.setToastInformationSaga,(0,r.setToastInformation)({toast:{show:!0,type:"fail",message:T}}));case 58:case"end":return g.stop()}}),Lr,null,[[17,41]])}function Qr(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,de.takeLatest)(Le,Br);case 2:case"end":return e.stop()}}),Hr)}var qr=(ae(jr={},se.UPDATE_LOCATION_MODE,(0,r.pureActionHandler)()),ae(jr,se.SET_CONVERSATION_BEEN_DELETED,(0,r.pureActionHandler)()),jr),Wr=regeneratorRuntime.mark(Kr),zr=regeneratorRuntime.mark($r),Yr=regeneratorRuntime.mark(Xr),Jr=!0;function Kr(){var e,t,n,r,o;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,de.select)(N);case 2:if(!(e=a.sent)){a.next=8;break}if(t=e.status,n=e.id,r=e.unread_count,o=e.latest_message_id,!("closed"!==t&&r>0)){a.next=8;break}return a.next=8,(0,de.put)(Ce({conversationId:n,isRead:!0,latestMessageId:o}));case 8:case"end":return a.stop()}}),Wr)}function $r(e){var t,n,o,a,s;return regeneratorRuntime.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return o=e.payload,a=o.from,s=o.callback,c.next=3,(0,de.call)(ut.updateChatbotFrom,a||pe.ChatbotFromType.LandingPage);case 3:return null===(t=window)||void 0===t||null===(n=t.CsChat)||void 0===n||n.minimizeCsChatWindow(),c.next=6,(0,de.call)(Kr);case 6:if(!Jr){c.next=12;break}return c.next=9,(0,de.spawn)(r.fetchSettings);case 9:return c.next=11,(0,de.call)(ln,{payload:{direction:"reset",startChatErrorCallback:s}});case 11:Jr=!1;case 12:return c.next=14,(0,de.call)(ut.handleNewConversationMessageQueue);case 14:case"end":return c.stop()}}),zr)}function Xr(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,de.takeEvery)($e,$r);case 2:case"end":return e.stop()}}),Yr)}var Zr=regeneratorRuntime.mark(eo);function eo(e,t){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=JSON.parse(pe.LS.getItem("mini-filter"))||{},t.next=3,(0,de.select)(C);case 3:if(r=t.sent,!n.filter||n.userid!==e||n.filter===r){t.next=8;break}return t.next=8,(0,de.put)(Re({filter:n.filter}));case 8:case"end":return t.stop()}}),Zr)}function to(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function no(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?to(Object(n),!0).forEach((function(t){ae(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):to(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ro=[ct,Dn,rt,zn,Xn,_n,nr,pr,Nr,Un,Ur,Qr,Xr],oo={conversationIds:[],pinnedConversationIds:[],conversationIdsMap:{},maxLatestTimestampNano:"",latestTimestampNano:"",oldestTimestampNano:"",oldestMessageRegion:"",latestMessageRegion:"",oldestReceivedMessageId:"",latestReceivedMessageId:"",maxLatestReceivedMessageId:"",currentConversationId:null,currentConversationCanRead:!0,filter:"All",draftHash:{},status:"",hasMore:!0,persist:null,results:[],direction:"",searchStatus:"",inlocation:!1,conversationBeenDeleted:!1,syncFetchException:0,conversationMark:{},readRequestIds:[],missedReadNoticeCount:0,access:vr([]),updateTimeNow:"0",isNavigateToUnreadMessage:!1,navigateToUnreadMessageId:"",pendingOffersCount:{},nextMessageTimeNano:"",subAccountNextTimestampNano:"",subAccountLastMessageNano:"",totalConversationsCount:{unrepliedCount:0,duesoonCount:0,overdueCount:0,pinnedCount:0,unreadCount:0},selection:{mode:!1,list:[],id:null},batchForward:{}},ao=(0,ce.handleActions)(no(no(no(no(no(no(no(no(no(no(no({},it),wn),Fn),Vn),Sn),ar),Yn),Sr),Fr),qr),Rr),oo);function so(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function co(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?so(Object(n),!0).forEach((function(t){ae(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):so(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var io,uo=pe.MessageTypes.MSG_TYPE_OFFER,lo=pe.MessageTypes.MSG_TYPE_ORDER,po=pe.MessageTypes.MSG_TYPE_PRODUCT,fo=pe.MessageTypes.MSG_TYPE_FAQ_UNSUPPORTED,Eo=pe.MessageTypes.MSG_TYPE_FAQ_LIVEAGENT_PROMPT,_o=pe.MessageTypes.MSG_TYPE_RATE_CARD,vo=[lo,po],So=(0,t.createSelector)((function(e){return e}),(function(e){return(e.messageReducer||{}).messagesRelatedMap||{}})),mo=function(e){var t;return(null===(t=e.messageReducer)||void 0===t?void 0:t.videoMap)||{}},Oo=function(e){return(0,t.createSelector)(mo,(function(t){return JSON.parse(JSON.stringify(t[e]||{}))}))},To=function(e){return(0,t.createSelector)(mo,(function(t){return Object.keys(t).find((function(n){return t[n].vid===e}))}))},go=function(n){return(0,t.createSelector)(r.messageEntitiesSelector,(function(t){return(0,e.denormalize)(n,o.messageSchema,{messages:t})}))},Ro=(0,t.createSelector)(p,So,(function(e,t){return t[e]||{all:[]}})),Co=function(e){return(0,t.createSelector)(So,(function(t){return t[e]||{all:[],sending:[],failed:[]}}))},Io=(io=function(e){return(0,t.createSelector)(Co(e),P(e),r.messageEntitiesSelector,(function(e,t,n){return(0,r.getConversationLastMessage)(e,t,n)}))},function(){var e=Array.prototype.slice.call(arguments);return io.memoize=io.memoize||{},e in io.memoize?io.memoize[e]:io.memoize[e]=io.apply(this,e)}),ho=(0,t.createSelector)(Ro,(function(e){var t=pt(e.all||[]);return e.securityTipsMessageId&&t.push(e.securityTipsMessageId),t})),No=(0,t.createSelector)(Ro,(function(e){return e.sending||[]})),bo=(0,t.createSelector)(Ro,(function(e){return e.failed||[]})),xo=(0,t.createSelector)(r.messageEntitiesSelector,ho,(function(t,n){return((0,e.denormalize)(n,[o.messageSchema],{messages:t})||[]).filter(Boolean)})),Ao=(0,t.createSelector)(xo,(function(e){return e.reverse()})),yo=(0,t.createSelector)(N,Ao,(function(e,t){return e?t.filter(Boolean).reduce((function(e,t){var n=t.type,r=t.source_type,o=t.source_content,a=t.content;if(!r||n===uo||[-1,0].includes(o["".concat(r,"_id")]))return e;if(vo.includes(n)&&o){var s="".concat(n,"_id");if(a[s]===o[s])return e}var c=e.lastSourceMessage,i=e.sourceList;if(!i.length)return{sourceList:i.concat(t),lastSourceMessage:t};if(r===po){var u=null==o?void 0:o.product_id,d=c.source_content&&c.source_content.product_id;if(!u||d===u)return e}else if(r===lo){var l=null==o?void 0:o.order_id,p=c.source_content&&c.source_content.order_id;if(!l||[-1,0,p].includes(l))return e}return{sourceList:i.concat(t),lastSourceMessage:t}}),{sourceList:[],lastSourceMessage:null}).sourceList:[]})),Do=(0,t.createSelector)(yo,(function(e){return e.map((function(e){return e.id}))})),wo=(0,t.createSelector)(r.entitiesSelector,xo,(function(t,n){var r=n.filter((function(e){return e&&e.type===uo})).map((function(e){return e.content.offer_id}));return(0,e.denormalize)(r,[o.offerSchema],t)})),ko=(0,t.createSelector)(Ao,Do,No,bo,N,r.rateCardEntitiesSelector,wo,(function(e,t,n,r,o,a,s){return o?e.filter((function(e){if(!e)return!1;var t=e.content,n=e.type;return!(![fo,Eo].includes(n)&&(!t||t&&0===Object.keys(t).length))})).map((function(e){var o=n.includes(e.id)?pe.MessageSendStatus.SENDING:r.includes(e.id)?pe.MessageSendStatus.FAILED:e.send_status?pe.MessageSendStatus.SUCCEED:null,c=t.includes(e.id),i=Object.assign({},e,{send_status:o,hasMessageSource:c}),u=i,d=u.type,l=u.content,p=void 0===l?{}:l,f=u.message_option;switch(d){case uo:var E=s.find((function(e){return e&&e.id===p.offer_id}));i=Object.assign({},i,{textContent:E});break;case _o:var _=a[p.card_id];_&&(i=Object.assign({},i,{textContent:_}))}return(0,pe.hasTargetMessageOption)(f,pe.MessageOption.MSG_OPT_CENSORED_BLACKLIST)&&(i=co(co({},i),{},{send_status:pe.MessageSendStatus.FAILED,errorCode:pe.MessageErrorCode.BLACKLIST})),i})):[]})),Po=(0,t.createSelector)((function(e){var t;return null==e||null===(t=e.messageReducer)||void 0===t?void 0:t.reply}),(function(e){return e?e.toMessageId:{}})),Mo=(0,t.createSelector)(p,Po,(function(e,t){return t[e]||""})),Uo=(0,t.createSelector)(Mo,r.messageEntitiesSelector,(function(t,n){return(0,e.denormalize)(t,o.messageSchema,{messages:n})})),jo=(0,t.createSelector)(p,(function(e){var t;return(null===(t=e.mediaPreviewerReducer)||void 0===t?void 0:t.mediaMap)||{}}),(function(e,t){return t[e]||[]})),Fo=regeneratorRuntime.mark(zo);function Vo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Lo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vo(Object(n),!0).forEach((function(t){ae(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ho,Go=6e4,Bo=48e4,Qo=Go,qo=!1,Wo="9223372036854775807";function zo(){var e,t,n,a,s,c,i,u,d,l,p,f,E,_,v,S,m;return regeneratorRuntime.wrap((function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=3,(0,de.delay)(Qo);case 3:return e=void 0,e="mini-session",O.next=7,(0,pe.getItem)(e);case 7:if(!(t=O.sent)||!t.token){O.next=58;break}return O.prev=9,O.next=12,(0,de.select)((function(e){return e.conversationReducer}));case 12:return n=O.sent,a=n.maxLatestReceivedMessageId,s=n.maxLatestTimestampNano,O.next=17,(0,de.select)(r.isSubAccountSelector);case 17:return c=O.sent,O.next=20,(0,de.select)(C);case 20:return i=O.sent.toLowerCase(),u=!c&&["all","unread"].includes(i),d=["pinned","unread"].includes(i),l={},u?l.last_timestamp_nano=s||Wo:l.last_message_id=a||Wo,l.last_unread_count_sync=qo,O.next=28,(0,de.spawn)(o.fetch,{method:"POST",resource:"user",suffix:"sync",params:Lo({},l)});case 28:return p=O.sent,O.next=31,(0,de.join)(p);case 31:if(f=O.sent,E=f.have_new_msg,_=f.unread_count,v=f.current_version,qo=!1,!E){O.next=44;break}return O.next=39,(0,de.select)((function(e){return e.conversationReducer}));case 39:if(!(O.sent.syncFetchException<3)||d){O.next=44;break}return O.next=44,(0,de.put)(me({direction:"latest",source:pe.ConversationSource.SYNC}));case 44:if(!(_>-1)){O.next=53;break}return O.next=47,(0,de.select)(r.totalUnreadConversationsCountSelector);case 47:if((S=O.sent)===_){O.next=52;break}return O.next=51,(0,de.put)((0,ut.updateTotalUnreadConversationsCount)({count:_}));case 51:qo=!0;case 52:c||(Qo=S!==_||E?Go:Qo>=Bo?Bo:2*Qo);case 53:v&&v!==t.version&&(m=Object.assign({},t,{version:v}),(0,pe.setItem)(e,m)),O.next=58;break;case 56:O.prev=56,O.t0=O.catch(9);case 58:O.next=0;break;case 60:case"end":return O.stop()}}),Fo,null,[[9,56]])}function Yo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Jo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yo(Object(n),!0).forEach((function(t){ae(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.REDIRECT_CONVERSATION_REQUESTED="REDIRECT_CONVERSATION_REQUESTED"}(Ho||(Ho={}));var Ko=regeneratorRuntime.mark(ta),$o=regeneratorRuntime.mark(na),Xo=regeneratorRuntime.mark(ra),Zo=regeneratorRuntime.mark(oa),ea=(0,ce.createActions)(ae({},Ho.REDIRECT_CONVERSATION_REQUESTED,(function(e){var t=e.userId,n=e.shopId,r=e.orderId,o=e.productId,a=e.message;return{userId:t,shopId:n,orderId:r,productId:o,message:void 0===a?"":a,entryPointType:e.entryPointType,callback:e.callback}}))).redirectConversationRequested;function ta(e){var t;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=(0,o.normalize)("conversations",e),n.next=3,(0,de.put)((0,r.updateEntities)({entities:t.entities}));case 3:case"end":return n.stop()}}),Ko)}function na(e){var t,n,r,a;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return t=e.userId,n=e.shopId,r=e.callback,s.prev=1,s.next=4,(0,de.call)(o.fetch,{method:"POST",resource:"conversation",suffix:"redirection",payload:JSON.stringify({user_id:parseInt(t),shop_id:n})});case 4:return a=s.sent,s.abrupt("return",a);case 8:return s.prev=8,s.t0=s.catch(1),r&&r(pe.StartChatErrorCode.Redirection),s.abrupt("return",null);case 12:case"end":return s.stop()}}),$o,null,[[1,8]])}function ra(e){var t,n,o,a,s,i,u,d,l,f,E,_,v,S,m,O,T,g,R,C,I;return regeneratorRuntime.wrap((function(h){for(;;)switch(h.prev=h.next){case 0:return t=e.payload,n=t.userId,o=t.shopId,a=t.orderId,s=t.isFromSearch,i=void 0!==s&&s,u=t.productId,d=t.message,l=t.entryPointType,f=t.callback,h.next=3,(0,de.select)(c);case 3:return E=h.sent,h.next=6,(0,de.call)(na,{userId:n,shopId:o,callback:f});case 6:if(_=h.sent){h.next=9;break}return h.abrupt("return");case 9:if(v=_.id,S=_.faking,m=_.mask,O=_.to_name,g=Jo(Jo({userId:n,shopId:o},T={orderId:a,productId:u}),{},{conversationId:_.id}),R=E.length,C=S||!E.includes(v),!l){h.next=17;break}return h.next=17,(0,de.put)((0,ut.setEntryPoint)({type:l,conversationId:v}));case 17:if(!C){h.next=25;break}return h.next=20,(0,de.call)(ta,_);case 20:if(!R){h.next=23;break}return h.next=23,(0,de.put)(Se({conversationId:v}));case 23:h.next=27;break;case 25:return h.next=27,(0,de.put)((0,r.updateRecord)({name:"conversations",id:v,record:{to_name:O,mask:m}}));case 27:if(!d){h.next=30;break}return h.next=30,(0,de.put)((0,ut.saveDraft)({conversationId:v,draft:d}));case 30:return h.next=32,(0,de.call)(pe.setItem,"mini-sc_redirect",g);case 32:return h.next=34,(0,de.select)(p);case 34:if(h.sent===v&&!C){h.next=40;break}return h.next=38,(0,de.put)(ze({conversationId:_.id}));case 38:return h.next=40,(0,de.put)(xe({conversation:_,sourceInfo:T,startChatErrorCallback:f}));case 40:return h.next=42,(0,de.select)(r.showChatWindowSelector);case 42:if(h.sent){h.next=50;break}return I="",a?I=pe.ChatbotFromType.OrderPage:u?I=pe.ChatbotFromType.ProductPage:o&&(I=pe.ChatbotFromType.ShopPage),h.next=48,(0,de.put)((0,r.updateChatWindowStatus)({showChatWindow:!0}));case 48:return h.next=50,(0,de.call)($r,{payload:{from:I,callback:f}});case 50:if(R){h.next=53;break}return h.next=53,(0,de.put)(Se({conversationId:v}));case 53:return h.next=55,(0,de.put)((0,r.updateConversationDetailStatus)({showConversationDetail:!0}));case 55:if(i){h.next=58;break}return h.next=58,(0,de.put)((0,ut.sendMessagesRequested)({conversationId:_.id,messages:[{type:"text",content:{text:""},isFaking:!0}],more:{isFakingSource:!0}}));case 58:case"end":return h.stop()}}),Xo)}function oa(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,de.takeEvery)(ea,ra);case 2:case"end":return e.stop()}}),Zo)}var aa=[zo,oa],sa=function(e){var t;return(null==e||null===(t=e.socketReducer)||void 0===t?void 0:t.feedback)||void 0},ca=function(e){var t;return(null==e||null===(t=e.socketReducer)||void 0===t?void 0:t.reconnectFlag)||!1},ia=function(e){var t;return(null==e||null===(t=e.socketReducer)||void 0===t?void 0:t.noticesCount)||0}}(),E}())},66633:function(e,t,n){"use strict";e.exports=n(55698)}}]);